<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guild Hub 1.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: linear-gradient(90deg, #051A0F 0%, #021207 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        .app-header {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #8b7355;
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
            margin-bottom: 4px;
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.05) 50%, transparent 70%);
            pointer-events: none;
        }

        .app-header h1 {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                1px 1px 2px rgba(0, 0, 0, 0.8),
                0 0 6px rgba(255, 215, 0, 0.3);
            font-family: 'Times New Roman', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .guild-selector {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            border: 2px solid #8b7355;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .guild-selector:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            border-color: #a0522d;
        }

        .guild-selector:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        /* Guild Login Screen */
        .guild-login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0A0502 0%, #1A0F0A 50%, #0A0502 100%);
        }

        .guild-login-form {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 2px solid #8b7355;
            border-radius: 8px;
            padding: 25px;
            width: 100%;
            max-width: 300px;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 6px 12px rgba(0, 0, 0, 0.6);
        }

        .guild-login-form h2 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #ffd700;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 2px solid #8b7355;
            border-radius: 6px;
            padding: 10px;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
            font-size: 0.9rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .form-group input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: normal;
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .login-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .current-guild-info {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: bold;
            border: 1px solid #8b7355;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .campaign-selector-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .campaign-selector {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            border: 2px solid #8b7355;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: normal;
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
            min-width: 150px;
        }

        .campaign-selector:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            border-color: #a0522d;
        }

        .campaign-selector:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        .new-campaign-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: normal;
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: none;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .new-campaign-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* Campaign Modal */
        .campaign-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .campaign-modal-content {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 2px solid #8b7355;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .campaign-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #8b7355;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border-radius: 10px 10px 0 0;
        }

        .campaign-modal-header h3 {
            color: #ffd700;
            font-size: 1.4rem;
            font-weight: bold;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .campaign-modal-body {
            padding: 20px;
        }

        .campaign-modal-body .form-group {
            margin-bottom: 20px;
        }

        .campaign-modal-body .form-group label {
            display: block;
            color: #ffd700;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .campaign-modal-body .form-group input,
        .campaign-modal-body .form-group textarea {
            width: 100%;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 2px solid #8b7355;
            border-radius: 6px;
            padding: 12px;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
            font-size: 1rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .campaign-modal-body .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .campaign-modal-body .form-group input:focus,
        .campaign-modal-body .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        .campaign-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .cancel-btn {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            color: #ffffff;
            border: 2px solid #374151;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cancel-btn:hover {
            background: linear-gradient(180deg, #4b5563 0%, #374151 100%);
            transform: translateY(-1px);
        }

        .create-campaign-btn {
            background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
            color: #ffffff;
            border: 2px solid #15803d;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .create-campaign-btn:hover {
            background: linear-gradient(180deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-1px);
        }

        /* Our Story Section */
        .our-story-section {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #8b7355;
            border-radius: 8px;
            margin: 20px 40px;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .our-story-header {
            padding: 12px 18px;
            border-bottom: 1px solid #8b7355;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border-radius: 7px 7px 0 0;
        }

        .our-story-header h2 {
            color: #ffd700;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .our-story-content {
            display: flex;
            gap: 15px;
            padding: 15px;
        }

        .story-text-area {
            flex: 2;
        }

        .story-text-area textarea {
            width: 100%;
            min-height: 120px;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 1px solid #8b7355;
            border-radius: 6px;
            padding: 12px;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
            font-size: 0.85rem;
            line-height: 1.5;
            resize: vertical;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .story-text-area textarea:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        .story-image-placeholder {
            flex: 1;
            min-width: 200px;
        }

        .image-placeholder {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 1px dashed #8b7355;
            border-radius: 6px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #b0b0b0;
            font-family: 'Times New Roman', serif;
            padding: 12px;
        }

        .image-placeholder span {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .image-placeholder p {
            font-size: 0.8rem;
            margin: 0;
            text-align: center;
        }

        /* Character Section */
        .character-section {
            margin-top: 30px;
        }

        .character-section-header {
            margin-bottom: 5px;
            text-align: center;
        }

        .character-section-header h2 {
            color: #ffd700;
            font-size: 12px;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Campaign Banner */
        .campaign-banner-section {
            margin-bottom: 30px;
        }

        .campaign-banner {
            position: relative;
            height: 200px;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 2px solid #8b7355;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .campaign-banner.has-image {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .campaign-banner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.7) 0%,
                rgba(0, 0, 0, 0.4) 50%,
                rgba(0, 0, 0, 0.7) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .campaign-banner-title {
            color: #ffd700;
            font-size: 2.5rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(255, 215, 0, 0.4);
            margin: 0;
            text-align: center;
        }

        .campaign-banner-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 3;
            display: flex;
            gap: 10px;
        }

        .generate-banner-btn,
        .regenerate-banner-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-banner-btn:hover,
        .regenerate-banner-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .generate-banner-btn.loading {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            color: #ffffff;
            cursor: not-allowed;
        }

        .generate-banner-btn.loading:hover {
            transform: none;
        }

        /* Dice Roller Button */
        .dice-roller-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 1px solid #a0522d;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Times New Roman', serif;
            min-width: 120px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dice-roller-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* Small Dice Roller Popup */
        .dice-roller-popup {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .dice-roller-popup-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 1px solid #8b7355;
            border-radius: 8px;
            padding: 0;
            width: 400px;
            max-height: 500px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .dice-roller-popup-header {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border-bottom: 1px solid #8b7355;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 7px 7px 0 0;
        }

        .dice-roller-popup-header h3 {
            color: #ffd700;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            font-family: 'Times New Roman', serif;
        }

        .close-dice-popup-btn {
            background: linear-gradient(180deg, #6b5b3a 0%, #4a4a4a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Times New Roman', serif;
        }

        .close-dice-popup-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #6b5b3a 100%);
            transform: scale(1.1);
        }

        .dice-roller-popup-body {
            padding: 12px;
        }

        .dice-selection-popup {
            margin-bottom: 12px;
        }

        .dice-type-selector-popup {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 10px;
        }

        .dice-type-btn-popup {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
        }

        .dice-type-btn-popup:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            border-color: #a0522d;
        }

        .dice-type-btn-popup.active {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            border-color: #ffd700;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.3);
        }

        .dice-controls-popup {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-group label {
            color: #ffd700;
            font-weight: bold;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
        }

        .quantity-controls-popup,
        .modifier-controls-popup {
            display: flex;
            align-items: center;
            gap: 3px;
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 2px 4px;
        }

        .quantity-controls-popup span,
        .modifier-controls-popup span {
            color: #ffd700;
            font-weight: bold;
            font-size: 0.8rem;
            min-width: 20px;
            text-align: center;
            font-family: 'Times New Roman', serif;
        }

        .control-btn-popup {
            background: linear-gradient(180deg, #6b5b3a 0%, #4a4a4a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 2px;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Times New Roman', serif;
        }

        .control-btn-popup:hover {
            background: linear-gradient(180deg, #a0522d 0%, #6b5b3a 100%);
            transform: scale(1.1);
        }

        .dice-tray-popup {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid #8b7355;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .dice-container-popup {
            display: flex;
            gap: 6px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            min-height: 35px;
        }

        .dice-popup {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            border: 1px solid #333;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            color: #fff;
            font-family: 'Times New Roman', serif;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Dice shapes based on type */
        .dice-popup.d4 {
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff3838 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(255, 107, 107, 0.4);
        }

        .dice-popup.d6 {
            border-radius: 3px;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 50%, #2c3e50 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(78, 205, 196, 0.4);
        }

        .dice-popup.d8 {
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            background: linear-gradient(135deg, #45b7d1 0%, #3498db 50%, #2980b9 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(69, 183, 209, 0.4);
        }

        .dice-popup.d10 {
            clip-path: polygon(50% 0%, 100% 20%, 100% 80%, 50% 100%, 0% 80%, 0% 20%);
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 50%, #d35400 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(243, 156, 18, 0.4);
        }

        .dice-popup.d12 {
            clip-path: polygon(50% 0%, 100% 15%, 100% 85%, 50% 100%, 0% 85%, 0% 15%);
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 50%, #7d3c98 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(155, 89, 182, 0.4);
        }

        .dice-popup.d20 {
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #a93226 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(231, 76, 60, 0.4);
        }

        .dice-popup.d100 {
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 50%, #229954 100%);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(46, 204, 113, 0.4);
        }

        .dice-popup.rolling {
            animation: diceRollPopup 0.8s ease-in-out;
        }

        @keyframes diceRollPopup {
            0% { 
                transform: rotate(0deg) scale(1) translateY(0px);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            }
            15% { 
                transform: rotate(45deg) scale(1.2) translateY(-8px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
            }
            30% { 
                transform: rotate(90deg) scale(0.8) translateY(4px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            }
            45% { 
                transform: rotate(180deg) scale(1.3) translateY(-12px);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.7);
            }
            60% { 
                transform: rotate(270deg) scale(0.7) translateY(6px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
            }
            75% { 
                transform: rotate(315deg) scale(1.1) translateY(-4px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            }
            100% { 
                transform: rotate(360deg) scale(1) translateY(0px);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            }
        }

        .roll-dice-btn-popup {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            color: #ffd700;
            border: 1px solid #ffd700;
            border-radius: 4px;
            padding: 6px 16px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Times New Roman', serif;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .roll-dice-btn-popup:hover {
            background: linear-gradient(180deg, #ffd700 0%, #a0522d 100%);
            color: #333;
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .roll-dice-btn-popup:disabled {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            color: #9ca3af;
            border-color: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .roll-result-popup {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 6px 10px;
            text-align: center;
            font-size: 0.8rem;
            color: #ffd700;
            font-weight: bold;
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Times New Roman', serif;
        }

        .roll-result-popup:empty {
            color: #666;
            font-style: italic;
        }

        .roll-history-popup {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 8px;
            margin-top: 6px;
        }

        .roll-history-popup h4 {
            color: #ffd700;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0 0 6px 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
        }

        .history-list-popup {
            max-height: 100px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .history-item-popup {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 4px 6px;
            font-size: 0.7rem;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
        }

        .history-item-popup .roll-result {
            color: #ffd700;
            font-weight: bold;
        }

        /* Message Board Button */
        .message-board-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 1px solid #a0522d;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Times New Roman', serif;
            min-width: 120px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-board-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* Message Board Popup */
        .message-board-popup {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .message-board-popup-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 1px solid #8b7355;
            border-radius: 8px;
            padding: 0;
            width: 450px;
            height: 400px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .message-board-popup-header {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border-bottom: 1px solid #8b7355;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 7px 7px 0 0;
        }

        .message-board-popup-header h3 {
            color: #ffd700;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            font-family: 'Times New Roman', serif;
        }

        .close-message-board-btn {
            background: linear-gradient(180deg, #6b5b3a 0%, #4a4a4a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Times New Roman', serif;
        }

        .close-message-board-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #6b5b3a 100%);
            transform: scale(1.1);
        }

        .message-board-popup-body {
            padding: 12px;
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 10px;
        }

        .message-input-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .character-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .character-selector label {
            color: #ffd700;
            font-weight: bold;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
            min-width: 60px;
        }

        .character-select {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 0.7rem;
            font-family: 'Times New Roman', serif;
            flex: 1;
        }

        .message-input-container {
            display: flex;
            gap: 6px;
        }

        .message-input {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            color: #e0e0e0;
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 6px 10px;
            font-size: 0.8rem;
            font-family: 'Times New Roman', serif;
            flex: 1;
        }

        .message-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
        }

        .send-message-btn {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            color: #ffd700;
            border: 1px solid #ffd700;
            border-radius: 3px;
            padding: 6px 12px;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
        }

        .send-message-btn:hover {
            background: linear-gradient(180deg, #ffd700 0%, #a0522d 100%);
            color: #333;
            transform: translateY(-1px);
        }

        .message-display {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid #8b7355;
            border-radius: 4px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 200px;
        }

        .message-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .message-item {
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 6px 8px;
            font-size: 0.7rem;
            color: #e0e0e0;
            font-family: 'Times New Roman', serif;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .message-character {
            color: #ffd700;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .message-time {
            color: #888;
            font-size: 0.6rem;
        }

        .message-content {
            color: #e0e0e0;
            word-wrap: break-word;
        }

        .message-tabs {
            display: flex;
            gap: 4px;
        }

        .message-tab {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            border: 1px solid #8b7355;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 0.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
            flex: 1;
        }

        .message-tab:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            border-color: #a0522d;
        }

        .message-tab.active {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            border-color: #ffd700;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
        }

        .status-message {
            padding: 6px 8px;
            border-radius: 4px;
            margin: 6px 0;
            font-weight: normal;
            font-size: 0.8rem;
        }

        .status-success {
            background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
            color: #ffffff;
            border: 1px solid #15803d;
        }

        .status-error {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
            color: #fecaca;
            border: 1px solid #991b1b;
            opacity: 0.9;
        }

        .guild-name-display {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #ffd700;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid #8b7355;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .connection-status {
            background: linear-gradient(180deg, #14532d 0%, #15803d 100%);
            color: #ffd700;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: bold;
            border: 1px solid #27ae60;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .connection-status.disconnected {
            background: linear-gradient(180deg, #7f1d1d 0%, #991b1b 100%);
            border-color: #dc2626;
        }

        .add-character-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: normal;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            font-family: 'Times New Roman', serif;
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .add-character-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .add-character-btn:active {
            transform: translateY(0);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.4),
                0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .app-main {
            flex: 1;
            padding: 10px;
            padding-top: 60px;
            overflow: auto;
            transform: scale(0.9);
            transform-origin: top center;
        }

        .character-deck {
            display: grid;
            grid-template-columns: repeat(auto-fit, 320px);
            gap: 18px;
            max-width: 1400px;
            margin: 0 auto 30px auto;
            padding: 30px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .character-deck {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .character-card {
            background: #17140F;
            border: none;
            border-radius: 8px;
            padding: 18px;
            padding-bottom: 60px;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 6px 12px rgba(0, 0, 0, 0.6);
            position: relative;
            transition: all 0.3s ease;
            min-height: 480px;
            max-width: 320px;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .character-card.new-card {
            animation: cardDealt 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            transform: translateX(-100vw) rotate(-15deg);
            opacity: 0;
        }

        @keyframes cardDealt {
            0% {
                transform: translateX(-100vw) rotate(-15deg) scale(0.8);
                opacity: 0;
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    0 20px 40px rgba(0, 0, 0, 0.8);
            }
            30% {
                opacity: 1;
                transform: translateX(-20px) rotate(-8deg) scale(0.95);
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    0 15px 30px rgba(0, 0, 0, 0.7);
            }
            70% {
                transform: translateX(10px) rotate(2deg) scale(1.02);
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    0 8px 16px rgba(0, 0, 0, 0.6);
            }
            85% {
                transform: translateX(0) rotate(-1deg) scale(1.01);
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    0 6px 12px rgba(0, 0, 0, 0.6);
            }
            100% {
                transform: translateX(0) rotate(0deg) scale(1);
                opacity: 1;
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    0 6px 12px rgba(0, 0, 0, 0.6);
            }
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.03) 50%, transparent 70%);
            pointer-events: none;
            border-radius: 5px;
        }

        .character-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                0 8px 16px rgba(0, 0, 0, 0.8);
            border-color: #a0522d;
        }

        /* Card Texture System */
        .card-texture {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 471px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 0;
            opacity: 1;
            transition: all 0.3s ease;
        }

        /* Default texture - bright yellow rounded rectangle */
        .card-texture.default {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 
                inset 0 2px 4px rgba(255, 255, 255, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Race-specific textures */
        .card-texture.human {
            background-image: url('textures/human.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.elf {
            background-image: url('textures/elf.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.dwarf {
            background-image: url('textures/dwarf.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.halfling {
            background-image: url('textures/halfling.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.dragonborn {
            background-image: url('textures/dragonborn.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.tiefling {
            background-image: url('textures/tiefling.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.half-orc {
            background-image: url('textures/halforc.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.gnome {
            background-image: url('textures/gnome.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.half-elf {
            background-image: url('textures/halfelf.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-texture.aarakocra {
            background: linear-gradient(135deg, #F0F8FF 0%, #B0C4DE 100%);
        }

        .card-header {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-bottom: 0;
            position: relative;
            z-index: 1;
        }

        /* Race-specific header element backgrounds - Target only hex stat input (2nd), not HP shield (1st) */
        .character-card.race-human .header-top-section,
        .character-card.race-human .header-bottom-section,
        .character-card.race-human .header-stat:nth-child(2) input[type="number"] {
            background: #DCBB78;
        }

        .character-card.race-dragonborn .header-top-section,
        .character-card.race-dragonborn .header-bottom-section,
        .character-card.race-dragonborn .header-stat:nth-child(2) input[type="number"] {
            background: #FFE0D3;
        }

        .character-card.race-elf .header-top-section,
        .character-card.race-elf .header-bottom-section,
        .character-card.race-elf .header-stat:nth-child(2) input[type="number"] {
            background: #CFDDCD;
        }

        .character-card.race-gnome .header-top-section,
        .character-card.race-gnome .header-bottom-section,
        .character-card.race-gnome .header-stat:nth-child(2) input[type="number"] {
            background: #D7DDCD;
        }

        .character-card.race-half-elf .header-top-section,
        .character-card.race-half-elf .header-bottom-section,
        .character-card.race-half-elf .header-stat:nth-child(2) input[type="number"] {
            background: #CFDDCD;
        }

        .character-card.race-halfling .header-top-section,
        .character-card.race-halfling .header-bottom-section,
        .character-card.race-halfling .header-stat:nth-child(2) input[type="number"] {
            background: #BDA89B;
        }

        .character-card.race-dwarf .header-top-section,
        .character-card.race-dwarf .header-bottom-section,
        .character-card.race-dwarf .header-stat:nth-child(2) input[type="number"] {
            background: #DCBB78;
        }

        .character-card.race-tiefling .header-top-section,
        .character-card.race-tiefling .header-bottom-section,
        .character-card.race-tiefling .header-stat:nth-child(2) input[type="number"] {
            background: #DCBB78;
        }

        .character-card.race-half-orc .header-top-section,
        .character-card.race-half-orc .header-bottom-section,
        .character-card.race-half-orc .header-stat:nth-child(2) input[type="number"] {
            background: #DCBB78;
        }

        /* NUCLEAR OPTION: Force HP shield to always be gold gradient */
        .character-card .header-stat:first-child .ac-inputs,
        .character-card.race-human .header-stat:first-child .ac-inputs,
        .character-card.race-dragonborn .header-stat:first-child .ac-inputs,
        .character-card.race-elf .header-stat:first-child .ac-inputs,
        .character-card.race-gnome .header-stat:first-child .ac-inputs,
        .character-card.race-half-elf .header-stat:first-child .ac-inputs,
        .character-card.race-halfling .header-stat:first-child .ac-inputs,
        .character-card.race-dwarf .header-stat:first-child .ac-inputs,
        .character-card.race-tiefling .header-stat:first-child .ac-inputs,
        .character-card.race-half-orc .header-stat:first-child .ac-inputs {
            background: linear-gradient(180deg, #602D12 0%, #713A17 36.98%, #4A1C0D 77.08%, #50210F 96.87%), #86543B !important;
            box-shadow: 2px -2px 3px 0 rgba(255, 255, 255, 0.40) inset, -2px 4px 4px 0 rgba(35, 35, 35, 0.70) inset !important;
        }

        /* NUCLEAR OPTION: Force HP shield inputs to be transparent */
        .character-card .header-stat:first-child .ac-input,
        .character-card .header-stat:first-child input.ac-input,
        .character-card .header-stat:first-child input.editable-field.ac-input,
        .character-card.race-human .header-stat:first-child .ac-input,
        .character-card.race-dragonborn .header-stat:first-child .ac-input,
        .character-card.race-elf .header-stat:first-child .ac-input,
        .character-card.race-gnome .header-stat:first-child .ac-input,
        .character-card.race-half-elf .header-stat:first-child .ac-input,
        .character-card.race-halfling .header-stat:first-child .ac-input,
        .character-card.race-dwarf .header-stat:first-child .ac-input,
        .character-card.race-tiefling .header-stat:first-child .ac-input,
        .character-card.race-half-orc .header-stat:first-child .ac-input {
            background: transparent !important;
        }



        .card-title {
            margin-bottom: 4px;
        }

        .card-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #000000;
            background: transparent;
            border: none;
            width: 100%;
            padding: 2px 8px;
            font-family: 'Merriweather', serif;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .header-top-section {
            background: #DCBB78;
            border: 2px solid #000;
            border-radius: 8px;
            padding: 8px 12px;
            position: relative;
            box-shadow: 
                -1.5px 4.5px 1.5px 0 rgba(255, 255, 255, 0.40) inset, 
                4.5px -4.5px 1.5px 0 rgba(68, 68, 68, 0.20) inset, 
                4.5px 0 1.5px 0 rgba(68, 68, 68, 0.20) inset, 
                0 -4.5px 1.5px 0 rgba(51, 51, 51, 0.50) inset;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bottom-section {
            background: #DCBB78;
            border: 2px solid #000;
            border-radius: 8px 8px 0 0;
            padding: 6px 12px 20px 12px;
            box-shadow: 
                -1.5px 4.5px 1.5px 0 rgba(255, 255, 255, 0.40) inset, 
                4.5px -4.5px 1.5px 0 rgba(68, 68, 68, 0.20) inset, 
                4.5px 0 1.5px 0 rgba(68, 68, 68, 0.20) inset, 
                0 -4.5px 1.5px 0 rgba(51, 51, 51, 0.50) inset;
            display: flex;
            flex-direction: column;
            gap: 0px;
            position: relative;
        }

        .header-stats {
            display: flex;
            gap: 5px;
            position: absolute;
            right: -15px;
            top: -10px;
            z-index: 10;
        }

        .header-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-stat input[type="number"] {
            background: #DCBB78;
            color: #000000;
            border: 1px solid #000000;
            border-radius: 4px;
            padding: 4px 8px;
            width: 50px;
            text-align: center;
            font-weight: 600;
        }

        .header-stat:nth-child(2) {
            position: relative;
        }



        .header-stat:nth-child(2) .heart-icon,
        .header-stat:nth-child(2) .ac-inputs {
            position: relative;
            z-index: 3;
        }

        .header-stat:nth-child(2) .ac-inputs {
            background: linear-gradient(180deg, #602D12 0%, #713A17 36.98%, #4A1C0D 77.08%, #50210F 96.87%), #86543B !important;
            box-shadow: 2px -2px 3px 0 rgba(255, 255, 255, 0.40) inset, -2px 4px 4px 0 rgba(35, 35, 35, 0.70) inset;
            border-radius: 18px;
            padding: 4px 10px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .ac-inputs {
            display: flex;
            align-items: center;
            gap: 0px;
        }

        .ac-input {
            background: transparent !important;
            color: #FFFFFF;
            border: none !important;
            border-radius: 0;
            padding: 0;
            width: 20px;
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
            outline: none;
        }

        .ac-separator {
            color: #FFFFFF;
            font-weight: 700;
            font-size: 0.85rem;
            margin: 0;
        }

        .heart-icon {
            font-size: 1rem;
            margin: 0;
        }

        /* Remove number input arrows for AC inputs */
        .ac-input::-webkit-outer-spin-button,
        .ac-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .ac-input {
            -moz-appearance: textfield;
        }

        .ac-input:focus {
            outline: none;
            border: none;
            background: transparent !important;
        }

        .header-stat:nth-child(2) .ac-input {
            background: transparent !important;
            color: #FFFFFF !important;
            width: 16px !important;
            padding: 0 !important;
            border: none !important;
            border-radius: 0 !important;
            font-size: 0.85rem !important;
            font-weight: 700 !important;
        }

        /* Hexagonal HP input */
        .hex-wrapper {
            position: relative;
            width: 41px;
            height: 41px;
            background: #000000;
            clip-path: polygon(50% 0%, 85% 15%, 85% 60%, 50% 90%, 15% 60%, 15% 15%);
            -webkit-clip-path: polygon(50% 0%, 85% 15%, 85% 60%, 50% 90%, 15% 60%, 15% 15%);
        }
        
        .header-stat:first-child input[type="number"] {
            background: linear-gradient(300deg, #DFCC66 14.12%, #E1D485 46.07%, #F0EECC 86.42%);
            color: #000000;
            border: none;
            width: 35px;
            height: 35px;
            padding: 0;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            clip-path: polygon(50% 0%, 85% 15%, 85% 60%, 50% 90%, 15% 60%, 15% 15%);
            -webkit-clip-path: polygon(50% 0%, 85% 15%, 85% 60%, 50% 90%, 15% 60%, 15% 15%);
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.3), inset 0 -1px 2px rgba(0, 0, 0, 0.2);
            position: absolute;
            top: 3px;
            left: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding-bottom: 5px;
        }
        
        .header-stat:first-child input[type="number"]:hover {
            background: linear-gradient(300deg, #E8D675 14.12%, #E9D994 46.07%, #F5F2D4 86.42%);
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.4), inset 0 -1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .header-stat:first-child input[type="number"]:focus {
            outline: none;
            background: #E8D675;
        }
        
        /* Remove number input arrows */
        .header-stat:first-child input[type="number"]::-webkit-outer-spin-button,
        .header-stat:first-child input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .header-stat:first-child input[type="number"] {
            -moz-appearance: textfield;
        }

        .card-name:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #a0522d;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .card-type {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }

        .card-class {
            font-size: 1.08rem;
            font-weight: 600;
            color: #2c1810;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(139, 115, 85, 0.3);
            width: 60%;
            padding: 3px 6px;
            font-family: 'Times New Roman', serif;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .card-class:focus {
            outline: none;
            background: rgba(255, 255, 255, 1);
            border: 1px solid #a0522d;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        .card-level {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.81rem;
            border: 1px solid #a0522d;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .level-input {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(139, 115, 85, 0.3);
            color: #2c1810;
            width: 2.5rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.81rem;
            font-family: 'Times New Roman', serif;
            border-radius: 4px;
        }

        .level-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 1);
            border: 1px solid #a0522d;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        .card-race {
            font-size: 0.81rem;
            color: #b0b0b0;
            font-style: italic;
        }

        .race-input {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(139, 115, 85, 0.3);
            color: #5c4a3a;
            font-style: italic;
            width: 100%;
            padding: 3px 6px;
            font-family: 'Times New Roman', serif;
            font-size: 0.81rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .race-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 1);
            border: 1px solid #a0522d;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
            border: 1px solid #a0522d;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .card-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 6px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .stat-label {
            font-weight: bold;
            color: #ffd700;
            min-width: 2.5rem;
            font-size: 0.81rem;
        }

        .stat-input {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 6px 8px;
            width: 4rem;
            text-align: center;
            font-family: 'Times New Roman', serif;
            color: #e0e0e0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-input:focus {
            outline: none;
            border-color: #a0522d;
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        .card-abilities {
            flex: 1;
        }

        .ability-grid {
            display: flex;
            justify-content: space-between;
            gap: 0px;
            flex-wrap: wrap;
        }

        .ability-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
            flex: 1;
            max-width: 35px;
        }

        .ability-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .stat-shield-wrapper {
            position: relative;
            width: 45px;
            height: 36px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='107' height='83' viewBox='0 0 107 83' fill='none'%3E%3Cg filter='url(%23filter0_ddii_6_396201)'%3E%3Cpath d='M15.6037 42.7525C15.0682 43.3716 15.1903 44.4322 15.9198 44.8037C23.0544 48.4369 51.9225 63.0908 53.4108 63.0908C54.913 63.0908 84.3066 48.1631 91.0953 44.7052C91.7785 44.3572 91.926 43.406 91.4883 42.7765C90.1543 40.8581 87.9555 36.5611 87.9555 29.0784C87.9555 23.0651 91.5097 14.221 92.9867 10.8053C93.2885 10.1072 92.8329 9.31156 92.0755 9.24168C86.4648 8.72402 66.7766 7.0001 53.4108 7.0001C40.3513 7.0001 21.2556 8.64595 15.1537 9.20425C14.2952 9.28279 13.8465 10.2887 14.3059 11.0181C16.2302 14.0741 19.9988 21.0799 19.9988 29.0784C19.9988 36.53 17.2731 40.8224 15.6037 42.7525Z' fill='url(%23paint0_linear_6_396201)'/%3E%3C/g%3E%3Cdefs%3E%3Cfilter id='filter0_ddii_6_396201' x='0.903583' y='0.390512' width='105.396' height='82.5288' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeFlood flood-opacity='0' result='BackgroundImageFix'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='6.60949'/%3E%3CfeGaussianBlur stdDeviation='6.60949'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 0'/%3E%3CfeBlend mode='normal' in2='BackgroundImageFix' result='effect1_dropShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='2.20316'/%3E%3CfeGaussianBlur stdDeviation='2.20316'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0'/%3E%3CfeBlend mode='normal' in2='effect1_dropShadow_6_396201' result='effect2_dropShadow_6_396201'/%3E%3CfeBlend mode='normal' in='SourceGraphic' in2='effect2_dropShadow_6_396201' result='shape'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='1.10158' dy='-1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.223529 0 0 0 0 0.184314 0 0 0 0 0.145098 0 0 0 0.6 0'/%3E%3CfeBlend mode='normal' in2='shape' result='effect3_innerShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='-1.10158' dy='1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.882422 0 0 0 0 0.87413 0 0 0 0 0.832671 0 0 0 1 0'/%3E%3CfeBlend mode='normal' in2='effect3_innerShadow_6_396201' result='effect4_innerShadow_6_396201'/%3E%3C/filter%3E%3ClinearGradient id='paint0_linear_6_396201' x1='53.4108' y1='63.0908' x2='53.4108' y2='7.0001' gradientUnits='userSpaceOnUse'%3E%3Cstop stop-color='%23E9EAEC'/%3E%3Cstop offset='0.385417' stop-color='%23E7E6E5'/%3E%3Cstop offset='0.71875' stop-color='%23DFDFE1'/%3E%3Cstop offset='1' stop-color='%23DFDEE3'/%3E%3C/linearGradient%3E%3C/defs%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .stat-shield-wrapper::before {
            content: '';
            position: absolute;
            top: calc(45% - 1px);
            left: 50%;
            transform: translate(-50%, -50%);
            width: 28px;
            height: 19px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='66' height='45' viewBox='0 0 66 45' fill='none'%3E%3Cg filter='url(%23filter0_d_6_396202)'%3E%3Cpath d='M3.95285 29.7333C3.93233 30.0474 4.08932 30.3338 4.37428 30.4675C7.92686 32.1352 31.0762 42.9824 32.1645 42.9824C33.256 42.9824 56.5449 32.0682 59.9869 30.4524C60.255 30.3265 60.4105 30.0651 60.4114 29.769C60.4165 28.0844 60.4498 22.4451 60.6647 19.8644C61.0059 15.7664 62.6399 8.90147 63.2399 6.47406C63.3539 6.01283 63.0284 5.55756 62.5546 5.52195C58.4867 5.2162 41.7054 3.99993 32.1645 3.99993C22.6572 3.99993 6.82033 5.20762 2.89895 5.51868C2.42662 5.55615 2.10637 6.00861 2.21872 6.46892C2.81941 8.93006 4.45014 15.9701 4.45014 19.8644C4.45014 21.9603 4.07051 27.9326 3.95285 29.7333Z' fill='%23191621'/%3E%3C/g%3E%3Cdefs%3E%3Cfilter id='filter0_d_6_396202' x='-0.00687361' y='0.695256' width='65.4727' height='43.3887' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeFlood flood-opacity='0' result='BackgroundImageFix'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='-1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.0980392 0 0 0 0 0.0862745 0 0 0 0 0.129412 0 0 0 1 0'/%3E%3CfeBlend mode='normal' in2='BackgroundImageFix' result='effect1_dropShadow_6_396202'/%3E%3CfeBlend mode='normal' in='SourceGraphic' in2='effect1_dropShadow_6_396202' result='shape'/%3E%3C/filter%3E%3C/defs%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 1;
        }

        .ability-input {
            background: transparent;
            color: #FFFFFF;
            border: none;
            width: 45px;
            height: 36px;
            padding: 0;
            text-align: center;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: absolute;
            top: -3px;
            left: 0;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ability-input:hover {
            background: rgba(232, 214, 117, 0.3);
        }

        .ability-input:focus {
            outline: none;
            background: rgba(232, 214, 117, 0.5);
        }

        /* Remove spin buttons for stat inputs */
        .ability-input::-webkit-outer-spin-button,
        .ability-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .ability-input[type=number] {
            -moz-appearance: textfield;
        }

        .custom-abilities {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #8b7355;
        }

        .custom-ability-item {
            margin-bottom: 6px;
        }

        .custom-ability-label {
            display: block;
            font-size: 0.8rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .custom-ability-input {
            width: 100%;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 4px 6px;
            font-family: "Times New Roman", serif;
            color: #e0e0e0;
            font-size: 0.8rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .custom-ability-input:focus {
            outline: none;
            border-color: #a0522d;
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            margin-left: -10px;
            margin-right: -10px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .footer-left,
        .footer-right {
            flex: 0 0 auto;
        }

        .footer-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        /* Death Saves UI */
        .death-saves {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .death-saves-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #8b7355;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
        }

        .death-saves-bubbles {
            display: flex;
            gap: 6px;
        }

        .death-save-bubble {
            width: 12px;
            height: 12px;
            border: 2px solid #8b7355;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .death-save-bubble:hover {
            border-color: #a0522d;
        }

        .death-save-bubble.filled {
            background: #8b0000;
            border-color: #a0522d;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3), 0 0 4px rgba(139, 0, 0, 0.3);
        }

        .remove-card-btn {
            background: linear-gradient(180deg, #8b0000 0%, #6b0000 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            border-radius: 6px;
            width: 2.5rem;
            height: 1.8rem;
            font-size: 1.08rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .remove-card-btn:hover {
            background: linear-gradient(180deg, #a00000 0%, #8b0000 100%);
            transform: scale(1.05);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .remove-card-btn:active {
            transform: scale(1);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.4),
                0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .editable-field:focus {
            outline: none;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        /* RuneScape-style scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #2a2a2a;
            border: 1px solid #8b7355;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            border-radius: 6px;
            border: 1px solid #a0522d;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
        }
            .basic-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            border-top: 1px solid #8b7355;
            padding: 8px 20px;
            color: #ffd700;
            font-family: "Times New Roman", serif;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .footer-left {
            display: flex;
            align-items: center;
        }
        .footer-middle {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }
        .footer-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .music-player {
            display: flex;
            justify-content: center;
        }
        .runescape-audio {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            border: 2px solid #a0522d;
            border-radius: 6px;
            padding: 4px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 2px 4px rgba(0, 0, 0, 0.4);
            width: 200px;
            height: 32px;
        }
        .runescape-audio::-webkit-media-controls-panel {
            background: linear-gradient(180deg, #6b5b3a 0%, #4a4a4a 100%);
        }
        .runescape-audio::-webkit-media-controls-play-button {
            background: linear-gradient(180deg, #ffd700 0%, #daa520 100%);
            border: 1px solid #a0522d;
            border-radius: 4px;
        }
        .app-main {
            padding-bottom: 60px;
        }

        /* Abilities Button */
        .abilities-btn {
            background: linear-gradient(180deg, #8b7355 0%, #6b5b3a 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 8px;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .abilities-btn:hover {
            background: linear-gradient(180deg, #a0522d 0%, #8b7355 100%);
            transform: scale(1.05);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* Abilities Modal */
        .abilities-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .abilities-modal-content {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 2px solid #8b7355;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .abilities-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #8b7355;
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border-radius: 10px 10px 0 0;
        }

        .abilities-modal-header h3 {
            color: #ffd700;
            font-size: 1.4rem;
            font-weight: bold;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .close-modal-btn {
            background: linear-gradient(180deg, #8b0000 0%, #6b0000 100%);
            color: #ffd700;
            border: 2px solid #a0522d;
            border-radius: 6px;
            width: 2rem;
            height: 2rem;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .close-modal-btn:hover {
            background: linear-gradient(180deg, #a00000 0%, #8b0000 100%);
            transform: scale(1.05);
        }

        .abilities-modal-body {
            padding: 20px;
        }

        .abilities-modal-body .custom-ability-item {
            margin-bottom: 15px;
        }

        .abilities-modal-body .custom-ability-label {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .abilities-modal-body .custom-ability-input {
            font-size: 0.9rem;
            padding: 8px 10px;
        }

        /* Card Tabs */
        .card-tabs {
            display: flex;
            background: transparent;
            position: absolute;
            bottom: -2px;
            left: 12px;
            right: 12px;
            border-radius: 0 0 8px 8px;
        }

        .tab-btn {
            background: transparent;
            color: #000000;
            border: none;
            padding: 8px 3px;
            font-size: 0.7rem;
            font-weight: 600;
            font-family: 'Merriweather', serif;
            cursor: pointer;
            flex: 1;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab-btn:hover {
            color: #333333;
        }

        .tab-btn.active {
            background: transparent;
            color: #000000;
            font-weight: 700;
            border-bottom: 4px solid #000000;
        }

        .tab-content {
            display: none;
            background: var(--gold-text, #FCF4DF);
            box-shadow: 1px -3px 3px 0 rgba(255, 255, 255, 0.30) inset, -3px 3px 3px 0 rgba(85, 85, 85, 0.45) inset;
            border-radius: 0 0 8px 8px;
            padding: 0 12px 12px 12px;
            position: relative;
            z-index: 1;
        }

        .tab-content.active {
            display: block;
        }

        /* Abilities Tab Content */
        .abilities-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .abilities-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .abilities-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .abilities-textarea {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 4px 6px;
            font-family: 'Times New Roman', serif;
            color: #2c1810;
            font-size: 0.75rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            resize: vertical;
            min-height: 30px;
        }

        .abilities-textarea:focus {
            outline: none;
            border-color: #a0522d;
            background: rgba(255, 255, 255, 1);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        /* Inventory Tab Content */
        .inventory-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .inventory-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .inventory-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .inventory-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 4px 6px;
            font-family: 'Times New Roman', serif;
            color: #2c1810;
            font-size: 0.75rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .inventory-textarea {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 4px 6px;
            font-family: 'Times New Roman', serif;
            color: #2c1810;
            font-size: 0.75rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            resize: vertical;
            min-height: 40px;
        }

        .inventory-input:focus,
        .inventory-textarea:focus {
            outline: none;
            border-color: #a0522d;
            background: rgba(255, 255, 255, 1);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        /* Story Tab Content */
        .story-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .story-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .story-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .story-textarea {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #8b7355;
            border-radius: 4px;
            padding: 4px 6px;
            font-family: 'Times New Roman', serif;
            color: #2c1810;
            font-size: 0.75rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            resize: vertical;
            min-height: 30px;
        }

        .story-textarea:focus {
            outline: none;
            border-color: #a0522d;
            background: rgba(255, 255, 255, 1);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 0 2px rgba(160, 82, 45, 0.3);
        }

        /* Character Image Section */
        .character-image-section {
            display: flex;
            justify-content: center;
            margin: 0 -12px 16px -12px;
        }

        .character-image-placeholder {
            width: 100%;
            height: 160px;
            border: 2px solid #8b7355 inset;
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .character-image-placeholder:hover {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
        }

        .image-placeholder-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-align: center;
        }

        .image-placeholder-text {
            font-size: 0.8rem;
            font-weight: 600;
            color: #e0e0e0;
        }

        .image-placeholder-subtext {
            font-size: 0.7rem;
            color: #a0a0a0;
        }

        .character-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0 0 4px 4px;
            position: absolute;
            top: 0;
            left: 0;
            max-width: 100%;
            max-height: 100%;
        }

        .character-image-placeholder {
            position: relative;
            overflow: hidden;
        }

        .character-image-placeholder.has-photo .image-placeholder-content {
            display: none;
        }

        .character-image-placeholder.has-photo:hover .image-placeholder-content {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 4px;
        }

        .character-image-placeholder.has-photo:hover .image-placeholder-text {
            color: #ffffff;
        }

        .character-image-placeholder.has-photo:hover .image-placeholder-subtext {
            color: #cccccc;
        }

        /* Delete Confirmation Modal */
        .delete-confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .delete-confirmation-content {
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 2px solid #8b7355;
            border-radius: 8px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .delete-confirmation-title {
            color: #e0e0e0;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .delete-confirmation-message {
            color: #c0c0c0;
            font-size: 1rem;
            margin-bottom: 24px;
            line-height: 1.4;
        }

        .delete-confirmation-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .delete-confirm-btn, .delete-cancel-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 100px;
        }

        .delete-confirm-btn {
            background: linear-gradient(180deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            border: 1px solid #f44336;
        }

        .delete-confirm-btn:hover {
            background: linear-gradient(180deg, #f44336 0%, #d32f2f 100%);
            transform: translateY(-1px);
        }

        .delete-cancel-btn {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #e0e0e0;
            border: 1px solid #666;
        }

        .delete-cancel-btn:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            transform: translateY(-1px);
        }

        /* Character Info Section */
        .character-info-section {
            margin-bottom: 12px;
        }

        .info-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .info-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c1810;
            min-width: 60px;
        }

        /* Inline Info Row Styling */
        .info-row {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            align-items: center;
        }

        .info-group-inline {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .info-label-inline {
            font-size: 0.8rem;
            font-weight: 600;
            color: #2c1810;
            white-space: nowrap;
        }

        .card-class-inline {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(44, 24, 16, 0.3);
            color: #2c1810;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 2px 4px;
            font-family: 'Times New Roman', serif;
            transition: all 0.2s ease;
            width: 60px;
        }

        .race-input-inline {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(44, 24, 16, 0.3);
            color: #2c1810;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 2px 4px;
            font-family: 'Times New Roman', serif;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 0;
        }

        .level-input-inline {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(44, 24, 16, 0.3);
            color: #2c1810;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 2px 4px;
            font-family: 'Times New Roman', serif;
            transition: all 0.2s ease;
            width: 30px;
            text-align: center;
        }

        .level-input-inline::-webkit-outer-spin-button,
        .level-input-inline::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .level-input-inline[type=number] {
            -moz-appearance: textfield;
        }

        .card-class-inline:focus,
        .race-input-inline:focus,
        .level-input-inline:focus {
            outline: none;
            border-bottom: 2px solid #8b7355;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Bio Section */
        .bio-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .bio-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .bio-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c1810;
            text-transform: none;
            letter-spacing: normal;
        }

        .bio-textarea {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 4px 0;
            font-family: 'Times New Roman', serif;
            color: #1a0f08;
            font-size: 0.75rem;
            box-shadow: none;
            resize: vertical;
            min-height: 30px;
        }

        .bio-textarea:focus {
            outline: none;
            background: transparent;
        }

        /* Active Effects Section */
        .active-effects-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 0;
        }

        .active-effects-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .active-effects-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c1810;
            text-transform: none;
            letter-spacing: normal;
        }

        .active-effects-textarea {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 4px 0;
            font-family: 'Times New Roman', serif;
            color: #1a0f08;
            font-size: 0.75rem;
            box-shadow: none;
            resize: vertical;
            min-height: 30px;
        }

        .active-effects-textarea:focus {
            outline: none;
            background: transparent;
        }

        /* Stat highlighting - colored shields */
        .ability-input.highest-stat {
            /* Remove border highlighting */
        }

        .ability-input.lowest-stat {
            /* Remove border highlighting */
        }

        /* Gold shield for highest stat */
        .stat-shield-wrapper.highest-stat {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='107' height='83' viewBox='0 0 107 83' fill='none'%3E%3Cg filter='url(%23filter0_ddii_6_396201)'%3E%3Cpath d='M15.6037 42.7525C15.0682 43.3716 15.1903 44.4322 15.9198 44.8037C23.0544 48.4369 51.9225 63.0908 53.4108 63.0908C54.913 63.0908 84.3066 48.1631 91.0953 44.7052C91.7785 44.3572 91.926 43.406 91.4883 42.7765C90.1543 40.8581 87.9555 36.5611 87.9555 29.0784C87.9555 23.0651 91.5097 14.221 92.9867 10.8053C93.2885 10.1072 92.8329 9.31156 92.0755 9.24168C86.4648 8.72402 66.7766 7.0001 53.4108 7.0001C40.3513 7.0001 21.2556 8.64595 15.1537 9.20425C14.2952 9.28279 13.8465 10.2887 14.3059 11.0181C16.2302 14.0741 19.9988 21.0799 19.9988 29.0784C19.9988 36.53 17.2731 40.8224 15.6037 42.7525Z' fill='url(%23paint0_linear_gold)'/%3E%3C/g%3E%3Cdefs%3E%3Cfilter id='filter0_ddii_6_396201' x='0.903583' y='0.390512' width='105.396' height='82.5288' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeFlood flood-opacity='0' result='BackgroundImageFix'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='6.60949'/%3E%3CfeGaussianBlur stdDeviation='6.60949'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 0'/%3E%3CfeBlend mode='normal' in2='BackgroundImageFix' result='effect1_dropShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='2.20316'/%3E%3CfeGaussianBlur stdDeviation='2.20316'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0'/%3E%3CfeBlend mode='normal' in2='effect1_dropShadow_6_396201' result='effect2_dropShadow_6_396201'/%3E%3CfeBlend mode='normal' in='SourceGraphic' in2='effect2_dropShadow_6_396201' result='shape'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='1.10158' dy='-1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.223529 0 0 0 0 0.184314 0 0 0 0 0.145098 0 0 0 0.6 0'/%3E%3CfeBlend mode='normal' in2='shape' result='effect3_innerShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='-1.10158' dy='1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.882422 0 0 0 0 0.87413 0 0 0 0 0.832671 0 0 0 1 0'/%3E%3CfeBlend mode='normal' in2='effect3_innerShadow_6_396201' result='effect4_innerShadow_6_396201'/%3E%3C/filter%3E%3ClinearGradient id='paint0_linear_gold' x1='53.4108' y1='63.0908' x2='53.4108' y2='7.0001' gradientUnits='userSpaceOnUse'%3E%3Cstop stop-color='%23FEF3C7'/%3E%3Cstop offset='0.385417' stop-color='%23FDE68A'/%3E%3Cstop offset='0.71875' stop-color='%23F59E0B'/%3E%3Cstop offset='1' stop-color='%23D97706'/%3E%3C/linearGradient%3E%3C/defs%3E%3C/svg%3E");
        }

        /* Red shield for lowest stat */
        .stat-shield-wrapper.lowest-stat {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='107' height='83' viewBox='0 0 107 83' fill='none'%3E%3Cg filter='url(%23filter0_ddii_6_396201)'%3E%3Cpath d='M15.6037 42.7525C15.0682 43.3716 15.1903 44.4322 15.9198 44.8037C23.0544 48.4369 51.9225 63.0908 53.4108 63.0908C54.913 63.0908 84.3066 48.1631 91.0953 44.7052C91.7785 44.3572 91.926 43.406 91.4883 42.7765C90.1543 40.8581 87.9555 36.5611 87.9555 29.0784C87.9555 23.0651 91.5097 14.221 92.9867 10.8053C93.2885 10.1072 92.8329 9.31156 92.0755 9.24168C86.4648 8.72402 66.7766 7.0001 53.4108 7.0001C40.3513 7.0001 21.2556 8.64595 15.1537 9.20425C14.2952 9.28279 13.8465 10.2887 14.3059 11.0181C16.2302 14.0741 19.9988 21.0799 19.9988 29.0784C19.9988 36.53 17.2731 40.8224 15.6037 42.7525Z' fill='url(%23paint0_linear_red)'/%3E%3C/g%3E%3Cdefs%3E%3Cfilter id='filter0_ddii_6_396201' x='0.903583' y='0.390512' width='105.396' height='82.5288' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeFlood flood-opacity='0' result='BackgroundImageFix'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='6.60949'/%3E%3CfeGaussianBlur stdDeviation='6.60949'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 0'/%3E%3CfeBlend mode='normal' in2='BackgroundImageFix' result='effect1_dropShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dy='2.20316'/%3E%3CfeGaussianBlur stdDeviation='2.20316'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0'/%3E%3CfeBlend mode='normal' in2='effect1_dropShadow_6_396201' result='effect2_dropShadow_6_396201'/%3E%3CfeBlend mode='normal' in='SourceGraphic' in2='effect2_dropShadow_6_396201' result='shape'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='1.10158' dy='-1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.223529 0 0 0 0 0.184314 0 0 0 0 0.145098 0 0 0 0.6 0'/%3E%3CfeBlend mode='normal' in2='shape' result='effect3_innerShadow_6_396201'/%3E%3CfeColorMatrix in='SourceAlpha' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0' result='hardAlpha'/%3E%3CfeOffset dx='-1.10158' dy='1.10158'/%3E%3CfeGaussianBlur stdDeviation='1.10158'/%3E%3CfeComposite in2='hardAlpha' operator='arithmetic' k2='-1' k3='1'/%3E%3CfeColorMatrix type='matrix' values='0 0 0 0 0.882422 0 0 0 0 0.87413 0 0 0 0 0.832671 0 0 0 1 0'/%3E%3CfeBlend mode='normal' in2='effect3_innerShadow_6_396201' result='effect4_innerShadow_6_396201'/%3E%3C/filter%3E%3ClinearGradient id='paint0_linear_red' x1='53.4108' y1='63.0908' x2='53.4108' y2='7.0001' gradientUnits='userSpaceOnUse'%3E%3Cstop stop-color='%23FECACA'/%3E%3Cstop offset='0.385417' stop-color='%23FCA5A5'/%3E%3Cstop offset='0.71875' stop-color='%23F87171'/%3E%3Cstop offset='1' stop-color='%23EF4444'/%3E%3C/linearGradient%3E%3C/defs%3E%3C/svg%3E");
        }

        /* Death styling */
        .character-card.dead {
            opacity: 0.6;
            filter: grayscale(80%);
            position: relative;
        }

        .character-card.dead::before {
            content: "💀";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .death-toggle-btn {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
            color: #ffffff;
            border: 1px solid #991b1b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.4);
            font-family: 'Times New Roman', serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 0;
        }

        .death-toggle-btn:hover {
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
            transform: translateY(-1px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.6);
        }

        .death-toggle-btn.alive {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            color: #e0e0e0;
            border-color: #8b7355;
            font-size: 0.5rem;
            padding: 3px 6px;
        }

        .death-toggle-btn.alive:hover {
            background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
            color: #ffffff;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 12px 2px 12px;
        }

        .footer-left {
            display: flex;
            align-items: center;
        }

        .footer-right {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Guild Login Screen -->
    <div id="guildLoginScreen" class="guild-login-screen">
        <div class="guild-login-form">
                                <h2 style="font-family: 'Times New Roman', serif; font-style: italic; font-size: 1.1rem; font-weight: normal; color: #ffd700; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); text-transform: none;">Speak Friend and Enter</h2>
            <div id="guildNameDisplay" class="guild-name-display"></div>
            <div class="form-group">
                <label for="guildPassword">Guild Password</label>
                <input type="password" id="guildPassword" placeholder="Enter guild password">
            </div>
            <button class="login-btn" onclick="loginToGuild()">Access Guild</button>
            <div id="guildLoginMessage"></div>
        </div>
    </div>

    <div class="app" id="mainApp" style="display: none;">
        <header class="app-header">
            <div class="header-left">
                <h1>Guild Hub 1.0</h1>
                <div id="connectionStatus" class="connection-status">
                    🔴 Disconnected
                </div>
            </div>
            <div class="header-controls">
                <div id="currentGuildInfo" class="current-guild-info"></div>
                <div class="campaign-selector-container">
                    <select id="campaignSelector" class="campaign-selector" onchange="switchCampaign(this.value)">
                        <option value="">Loading campaigns...</option>
                    </select>
                    <button class="new-campaign-btn" onclick="showNewCampaignModal()">
                        + New Campaign
                    </button>
                </div>
                <button class="add-character-btn" onclick="addCharacter()">
                    + Add Character
                </button>
            </div>
        </header>
        
        <main class="app-main">
            <!-- Character Section -->
            <div class="character-section">
                <div class="character-section-header">
                    <h2>Character Deck</h2>
                </div>
                <div class="character-deck" id="characterDeck">
                    <!-- Character cards will be added here -->
                </div>
            </div>

            <!-- Our Story Section -->
            <div class="our-story-section" id="ourStorySection">
                <div class="our-story-header">
                    <h2>Our Story</h2>
                </div>
                <div class="our-story-content">
                    <div class="story-text-area">
                        <textarea id="ourStoryText" placeholder="Tell the story of your campaign... the world, the characters, the adventures that await..."></textarea>
                    </div>
                    <div class="story-image-placeholder">
                        <div class="image-placeholder">
                            <span>📷</span>
                            <p>Campaign Image</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Campaign Info Edit Modal -->
    <div id="campaignInfoModal" class="campaign-modal">
        <div class="campaign-modal-content">
            <div class="campaign-modal-header">
                <h3>Edit Campaign Information</h3>
                <button class="close-modal-btn" onclick="closeCampaignInfoModal()">✕</button>
            </div>
            <div class="campaign-modal-body">
                <div class="form-group">
                    <label for="campaignBackstory">Backstory</label>
                    <textarea id="campaignBackstory" placeholder="Enter the campaign's backstory and lore..."></textarea>
                </div>
                <div class="form-group">
                    <label for="campaignWorld">World & Environment</label>
                    <textarea id="campaignWorld" placeholder="Describe the world, geography, and environment..."></textarea>
                </div>
                <div class="form-group">
                    <label for="campaignPolitics">Political Considerations</label>
                    <textarea id="campaignPolitics" placeholder="Describe political factions, governments, and power structures..."></textarea>
                </div>
                <div class="form-group">
                    <label for="campaignReligion">Religion & Culture</label>
                    <textarea id="campaignReligion" placeholder="Describe religious beliefs, cultural practices, and traditions..."></textarea>
                </div>
                <div class="form-group">
                    <label for="campaignMagic">Magic & Technology</label>
                    <textarea id="campaignMagic" placeholder="Describe magic systems, technology level, and special rules..."></textarea>
                </div>
                <div class="form-group">
                    <label for="campaignNotes">Additional Notes</label>
                    <textarea id="campaignNotes" placeholder="Any other important campaign information..."></textarea>
                </div>
                <div class="campaign-modal-actions">
                    <button class="cancel-btn" onclick="closeCampaignInfoModal()">Cancel</button>
                    <button class="create-campaign-btn" onclick="saveCampaignInfo()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div id="campaignModal" class="campaign-modal">
        <div class="campaign-modal-content">
            <div class="campaign-modal-header">
                <h3>Create New Campaign</h3>
                <button class="close-modal-btn" onclick="closeCampaignModal()">✕</button>
            </div>
            <div class="campaign-modal-body">
                <div class="form-group">
                    <label for="campaignName">Campaign Name</label>
                    <input type="text" id="campaignName" placeholder="Enter campaign name">
                </div>
                <div class="form-group">
                    <label for="campaignDescription">Description (Optional)</label>
                    <textarea id="campaignDescription" placeholder="Enter campaign description"></textarea>
                </div>
                <div class="campaign-modal-actions">
                    <button class="cancel-btn" onclick="closeCampaignModal()">Cancel</button>
                    <button class="create-campaign-btn" onclick="createCampaign()">Create Campaign</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration (single project for all guilds)
        const firebaseConfig = {
            apiKey: "AIzaSyBhYLrZ9g901o1ZA35OpQ4YBz_YFpaOPQk",
            authDomain: "dndcards.firebaseapp.com",
            databaseURL: "https://dndcards-default-rtdb.firebaseio.com",
            projectId: "dndcards",
            storageBucket: "dndcards.firebasestorage.app",
            messagingSenderId: "821071296173",
            appId: "1:821071296173:web:a0e5db9c9d5323de607824",
            measurementId: "G-HY29MSXDCP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Multi-tenant guild system with campaigns
        let currentGuildId = null;
        let currentGuildData = null;
        let currentCampaignId = null;
        let campaigns = [];
        let characters = [];
        let isConnected = false;
        let isAuthenticated = false;
        let activeTabs = {}; // Track active tab for each character

        // Get guild ID from URL
        function getGuildId() {
            // Try URL parameters first (works with file:// URLs)
            const urlParams = new URLSearchParams(window.location.search);
            const guildParam = urlParams.get('guild');
            if (guildParam) {
                return guildParam;
            }
            
            // Fallback to path-based routing (works with web servers)
            const path = window.location.pathname;
            const guildId = path.split('/')[1];
            if (guildId) {
                return guildId;
            }
            
            // Default to demo guild
            return 'demo';
        }

        // Get guild-specific database path
        function getGuildPath() {
            const guildId = getGuildId();
            return `guilds/${guildId}`;
        }

        // Get campaign-specific database path
        function getCampaignPath() {
            const guildId = getGuildId();
            const campaignId = currentCampaignId || 'default';
            return `guilds/${guildId}/campaigns/${campaignId}`;
        }

        // Update page title and header with guild info
        function updateGuildDisplay() {
            if (!currentGuildData) return;
            
            const guildName = currentGuildData.name;
            document.title = `${guildName} - Guild Hub 1.0`;
            
            const header = document.querySelector('.app-header h1');
            if (header) {
                header.textContent = `${guildName} - Guild Hub 1.0`;
            }
            
            // Update current guild info display
            const guildInfo = document.getElementById('currentGuildInfo');
            if (guildInfo) {
                guildInfo.textContent = guildName;
            }
        }

        // Login to guild
        function loginToGuild() {
            const password = document.getElementById('guildPassword').value;
            const guildId = getGuildId();
            const messageDiv = document.getElementById('guildLoginMessage');
            
            if (!password.trim()) {
                messageDiv.innerHTML = '<div class="status-message status-error">Please enter the guild password!</div>';
                return;
            }
            
            // Check guild credentials in admin database
            database.ref(`admin/guilds/${guildId}`).once('value')
                .then((snapshot) => {
                    if (!snapshot.exists()) {
                        messageDiv.innerHTML = '<div class="status-message status-error">Guild not found!</div>';
                        return;
                    }
                    
                    const guildData = snapshot.val();
                    if (guildData.password === password) {
                        // Authentication successful
                        isAuthenticated = true;
                        currentGuildId = guildId;
                        currentGuildData = guildData;
                        
                        // Hide login screen and show main app
                        document.getElementById('guildLoginScreen').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        
                        // Initialize the app
                        updateGuildDisplay();
                        loadCampaigns();
                        // Campaign info will be loaded when campaigns are loaded
                        
                        messageDiv.innerHTML = '';
                    } else {
                        messageDiv.innerHTML = '<div class="status-message status-error">Invalid password!</div>';
                    }
                })
                .catch((error) => {
                    messageDiv.innerHTML = '<div class="status-message status-error">Error: ' + error.message + '</div>';
                });
        }

        // Check if user is already authenticated for this guild
        function checkGuildAccess() {
            const guildId = getGuildId();
            
            // Check if guild exists
            database.ref(`admin/guilds/${guildId}`).once('value')
                .then((snapshot) => {
                    if (!snapshot.exists()) {
                        document.getElementById('guildLoginMessage').innerHTML = 
                            '<div class="status-message status-error">Guild not found! Please check the URL.</div>';
                        return;
                    }
                    
                    // Guild exists, show login screen with guild name
                    const guildData = snapshot.val();
                    const guildNameDisplay = document.getElementById('guildNameDisplay');
                    guildNameDisplay.textContent = guildData.name;
                    
                    document.getElementById('guildLoginScreen').style.display = 'flex';
                    document.getElementById('mainApp').style.display = 'none';
                })
                .catch((error) => {
                    document.getElementById('guildLoginMessage').innerHTML = 
                        '<div class="status-message status-error">Error: ' + error.message + '</div>';
                });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkGuildAccess();
        });

        // Handle Enter key in password field
        document.getElementById('guildPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginToGuild();
            }
        });

        // Handle Enter key in campaign name field
        document.getElementById('campaignName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                createCampaign();
            }
        });

        // Handle Escape key to close modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCampaignModal();
                closeCampaignInfoModal();
            }
        });

        // Campaign Management Functions
        function loadCampaigns() {
            const guildPath = getGuildPath();
            database.ref(`${guildPath}/campaigns`).on('value', (snapshot) => {
                campaigns = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        campaigns.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });
                }
                
                // If no campaigns exist, create a default one
                if (campaigns.length === 0) {
                    createDefaultCampaign();
                } else {
                    renderCampaignSelector();
                    // Set current campaign to first one if none selected
                    if (!currentCampaignId) {
                        switchCampaign(campaigns[0].id);
                    } else {
                        // Load campaign info and banner for current campaign
                        loadCampaignInfo();
                        loadCampaignBanner();
                    }
                }
            });
        }

        function createDefaultCampaign() {
            const defaultCampaign = {
                name: 'Main Campaign',
                description: 'Your primary campaign',
                createdDate: new Date().toISOString(),
                lastUpdated: Date.now()
            };
            
            const guildPath = getGuildPath();
            database.ref(`${guildPath}/campaigns/default`).set(defaultCampaign)
                .then(() => {
                    // Create placeholder characters for the default campaign
                    return createPlaceholderCharactersForCampaign(guildPath, 'default');
                })
                .then(() => {
                    currentCampaignId = 'default';
                    loadCampaigns();
                });
        }

        function renderCampaignSelector() {
            const selector = document.getElementById('campaignSelector');
            selector.innerHTML = '';
            
            campaigns.forEach(campaign => {
                const option = document.createElement('option');
                option.value = campaign.id;
                option.textContent = campaign.name;
                if (campaign.id === currentCampaignId) {
                    option.selected = true;
                }
                selector.appendChild(option);
            });
        }

        function switchCampaign(campaignId) {
            if (campaignId === currentCampaignId) return;
            
            console.log(`Switching from campaign ${currentCampaignId} to campaign ${campaignId}`);
            
            // Clear current data
            characters = [];
            renderCharacters();
            
            // Update current campaign
            currentCampaignId = campaignId;
            
            // Reload characters and campaign info for new campaign
            setupRealtimeListener();
            setupMessageListener();
            loadCampaignInfo();
            loadCampaignBanner();
        }

        function showNewCampaignModal() {
            document.getElementById('campaignModal').style.display = 'block';
            document.getElementById('campaignName').focus();
        }

        function closeCampaignModal() {
            document.getElementById('campaignModal').style.display = 'none';
            document.getElementById('campaignName').value = '';
            document.getElementById('campaignDescription').value = '';
        }

        function createCampaign() {
            const name = document.getElementById('campaignName').value.trim();
            const description = document.getElementById('campaignDescription').value.trim();
            
            if (!name) {
                alert('Please enter a campaign name');
                return;
            }
            
            const newCampaign = {
                name: name,
                description: description,
                createdDate: new Date().toISOString(),
                lastUpdated: Date.now()
            };
            
            const guildPath = getGuildPath();
            const campaignId = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();
            
            database.ref(`${guildPath}/campaigns/${campaignId}`).set(newCampaign)
                .then(() => {
                    // Create placeholder characters for the new campaign
                    return createPlaceholderCharactersForCampaign(guildPath, campaignId);
                })
                .then(() => {
                    closeCampaignModal();
                    // Switch to the new campaign
                    switchCampaign(campaignId);
                })
                .catch((error) => {
                    alert('Error creating campaign: ' + error.message);
                });
        }

        // Create placeholder characters for a new campaign
        function createPlaceholderCharactersForCampaign(guildPath, campaignId) {
            const characters = generatePlaceholderCharacters();
            const promises = characters.map(character => {
                return database.ref(`${guildPath}/campaigns/${campaignId}/characters`).push(character);
            });
            return Promise.all(promises);
        }

        // Generate 3 random placeholder characters
        function generatePlaceholderCharacters() {
            const fantasyNames = [
                'Aria Stormwind', 'Thorin Ironfist', 'Luna Shadowmoon', 'Gareth Brightblade', 'Zara Fireheart',
                'Marcus Stormcaller', 'Elara Nightwhisper', 'Ragnar Frostbeard', 'Seraphina Lightweaver', 'Kael Darkforge',
                'Isabella Moonstone', 'Drakon Bloodfist', 'Lyra Silverwing', 'Magnus Thunderfist', 'Nyx Voidwalker',
                'Valeria Sunseeker', 'Grimtooth Skullcrusher', 'Aurora Frostwind', 'Talon Swiftblade', 'Mystra Spellweaver'
            ];

            const classes = ['Fighter', 'Wizard', 'Rogue', 'Cleric', 'Ranger', 'Paladin', 'Bard', 'Druid', 'Monk', 'Warlock'];
            const races = ['Human', 'Elf', 'Dwarf', 'Halfling', 'Dragonborn', 'Tiefling', 'Half-Orc', 'Gnome', 'Half-Elf', 'Aarakocra'];

            const characters = [];
            
            for (let i = 0; i < 3; i++) {
                const name = fantasyNames[Math.floor(Math.random() * fantasyNames.length)];
                const characterClass = classes[Math.floor(Math.random() * classes.length)];
                const race = races[Math.floor(Math.random() * races.length)];
                const level = Math.floor(Math.random() * 10) + 1; // Level 1-10
                
                // Generate random stats (8-18 range)
                const strength = Math.floor(Math.random() * 11) + 8;
                const dexterity = Math.floor(Math.random() * 11) + 8;
                const constitution = Math.floor(Math.random() * 11) + 8;
                const intelligence = Math.floor(Math.random() * 11) + 8;
                const wisdom = Math.floor(Math.random() * 11) + 8;
                const charisma = Math.floor(Math.random() * 11) + 8;
                
                // Calculate HP based on class and constitution
                const baseHP = characterClass === 'Fighter' ? 10 : 8;
                const hp = baseHP + Math.floor((constitution - 10) / 2);
                
                // Calculate AC based on dexterity
                const ac = 10 + Math.floor((dexterity - 10) / 2);
                
                const character = {
                    name: name,
                    class: characterClass,
                    level: level,
                    race: race,
                    hp: Math.max(1, hp),
                    ac: Math.max(10, ac),
                    strength: strength,
                    dexterity: dexterity,
                    constitution: constitution,
                    intelligence: intelligence,
                    wisdom: wisdom,
                    charisma: charisma,
                    isDead: false,
                    lastUpdated: Date.now(),
                    // Add some placeholder content for other fields
                    background: `A ${race.toLowerCase()} ${characterClass.toLowerCase()} with a mysterious past.`,
                    personality: 'Brave and determined, always ready for adventure.',
                    goals: 'To become a legendary hero and protect the realm.',
                    weapon: 'Standard weapon',
                    armor: 'Basic armor',
                    items: 'Adventuring gear, rations, waterskin',
                    activeEffects: 'None currently',
                    ability1: 'Class ability - varies by character',
                    ability2: 'Racial trait - varies by character',
                    ability3: 'Background feature - varies by character',
                    ultimate: 'Signature move or spell - to be developed'
                };
                
                characters.push(character);
            }
            
            return characters;
        }

        // Campaign Info Management Functions
        function loadCampaignInfo() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/info`).once('value')
                .then((snapshot) => {
                    const info = snapshot.val() || {};
                    renderCampaignInfo(info);
                })
                .catch((error) => {
                    console.error('Error loading campaign info:', error);
                    renderCampaignInfo({});
                });
        }

        function renderCampaignInfo(info) {
            const content = document.getElementById('campaignInfoContent');
            
            content.innerHTML = `
                <div class="campaign-info-grid">
                    <div class="campaign-info-card">
                        <h3>Backstory</h3>
                        <div class="campaign-info-text ${!info.backstory ? 'empty' : ''}">
                            ${info.backstory || 'No backstory added yet. Click Edit to add campaign lore and history.'}
                        </div>
                    </div>
                    <div class="campaign-info-card">
                        <h3>World & Environment</h3>
                        <div class="campaign-info-text ${!info.world ? 'empty' : ''}">
                            ${info.world || 'No world information added yet. Click Edit to describe the setting and geography.'}
                        </div>
                    </div>
                    <div class="campaign-info-card">
                        <h3>Political Considerations</h3>
                        <div class="campaign-info-text ${!info.politics ? 'empty' : ''}">
                            ${info.politics || 'No political information added yet. Click Edit to describe factions and power structures.'}
                        </div>
                    </div>
                    <div class="campaign-info-card">
                        <h3>Religion & Culture</h3>
                        <div class="campaign-info-text ${!info.religion ? 'empty' : ''}">
                            ${info.religion || 'No religious information added yet. Click Edit to describe beliefs and cultural practices.'}
                        </div>
                    </div>
                    <div class="campaign-info-card">
                        <h3>Magic & Technology</h3>
                        <div class="campaign-info-text ${!info.magic ? 'empty' : ''}">
                            ${info.magic || 'No magic information added yet. Click Edit to describe magic systems and technology.'}
                        </div>
                    </div>
                    <div class="campaign-info-card">
                        <h3>Additional Notes</h3>
                        <div class="campaign-info-text ${!info.notes ? 'empty' : ''}">
                            ${info.notes || 'No additional notes added yet. Click Edit to add any other important campaign information.'}
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleCampaignInfoEdit() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/info`).once('value')
                .then((snapshot) => {
                    const info = snapshot.val() || {};
                    
                    // Populate the form
                    document.getElementById('campaignBackstory').value = info.backstory || '';
                    document.getElementById('campaignWorld').value = info.world || '';
                    document.getElementById('campaignPolitics').value = info.politics || '';
                    document.getElementById('campaignReligion').value = info.religion || '';
                    document.getElementById('campaignMagic').value = info.magic || '';
                    document.getElementById('campaignNotes').value = info.notes || '';
                    
                    // Show the modal
                    document.getElementById('campaignInfoModal').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error loading campaign info for editing:', error);
                    document.getElementById('campaignInfoModal').style.display = 'block';
                });
        }

        function closeCampaignInfoModal() {
            document.getElementById('campaignInfoModal').style.display = 'none';
        }

        function saveCampaignInfo() {
            const campaignPath = getCampaignPath();
            const info = {
                backstory: document.getElementById('campaignBackstory').value.trim(),
                world: document.getElementById('campaignWorld').value.trim(),
                politics: document.getElementById('campaignPolitics').value.trim(),
                religion: document.getElementById('campaignReligion').value.trim(),
                magic: document.getElementById('campaignMagic').value.trim(),
                notes: document.getElementById('campaignNotes').value.trim(),
                lastUpdated: Date.now()
            };
            
            database.ref(`${campaignPath}/info`).set(info)
                .then(() => {
                    closeCampaignInfoModal();
                    loadCampaignInfo();
                })
                .catch((error) => {
                    alert('Error saving campaign info: ' + error.message);
                });
        }

        // Campaign Banner Functions
        function loadCampaignBanner() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/banner`).once('value')
                .then((snapshot) => {
                    const bannerData = snapshot.val();
                    if (bannerData && bannerData.imageUrl) {
                        renderCampaignBanner(bannerData.imageUrl, bannerData.campaignName);
                    } else {
                        renderCampaignBanner(null, getCurrentCampaignName());
                    }
                })
                .catch((error) => {
                    console.error('Error loading campaign banner:', error);
                    renderCampaignBanner(null, getCurrentCampaignName());
                });
        }

        function getCurrentCampaignName() {
            const currentCampaign = campaigns.find(c => c.id === currentCampaignId);
            return currentCampaign ? currentCampaign.name : 'Campaign';
        }

        function renderCampaignBanner(imageUrl, campaignName) {
            const banner = document.getElementById('campaignBanner');
            const title = document.getElementById('campaignBannerTitle');
            const generateBtn = document.getElementById('generateBannerBtn');
            const regenerateBtn = document.getElementById('regenerateBannerBtn');

            title.textContent = campaignName;

            if (imageUrl) {
                banner.style.backgroundImage = `url(${imageUrl})`;
                banner.classList.add('has-image');
                generateBtn.style.display = 'none';
                regenerateBtn.style.display = 'block';
            } else {
                banner.style.backgroundImage = 'none';
                banner.classList.remove('has-image');
                generateBtn.style.display = 'block';
                regenerateBtn.style.display = 'none';
            }
        }

        function generateCampaignBanner() {
            console.log('generateCampaignBanner called');
            const campaignPath = getCampaignPath();
            console.log('Campaign path:', campaignPath);
            
            // Get world description for AI prompt
            database.ref(`${campaignPath}/info`).once('value')
                .then((snapshot) => {
                    console.log('Campaign info snapshot:', snapshot.val());
                    const info = snapshot.val() || {};
                    const worldDescription = info.world || '';
                    const campaignName = getCurrentCampaignName();
                    
                    console.log('World description:', worldDescription);
                    console.log('Campaign name:', campaignName);
                    
                    if (!worldDescription.trim()) {
                        alert('Please add some world description first to generate a banner!');
                        return;
                    }
                    
                    generateBannerWithAI(worldDescription, campaignName, campaignPath);
                })
                .catch((error) => {
                    console.error('Error getting campaign info:', error);
                    alert('Error getting campaign information');
                });
        }

        function regenerateCampaignBanner() {
            generateCampaignBanner();
        }

        function generateBannerWithAI(worldDescription, campaignName, campaignPath) {
            console.log('generateBannerWithAI called');
            console.log('World description:', worldDescription);
            console.log('Campaign name:', campaignName);
            console.log('Campaign path:', campaignPath);
            
            const generateBtn = document.getElementById('generateBannerBtn');
            const regenerateBtn = document.getElementById('regenerateBannerBtn');
            
            // Show loading state
            generateBtn.classList.add('loading');
            generateBtn.textContent = '🎨 Generating...';
            regenerateBtn.classList.add('loading');
            regenerateBtn.textContent = '🔄 Generating...';

            // Create AI prompt
            const prompt = `Create a fantasy landscape banner image for a D&D campaign called "${campaignName}". ${worldDescription}. Style: epic fantasy landscape, dramatic lighting, suitable for a banner, 16:9 aspect ratio, high quality, digital art.`;
            console.log('Generated prompt:', prompt);

            // Use a free AI image generation service (example with Unsplash API for placeholder)
            // In a real implementation, you'd use OpenAI DALL-E, Stable Diffusion, or similar
            generatePlaceholderBanner(prompt, campaignName, campaignPath);
        }

        function generatePlaceholderBanner(prompt, campaignName, campaignPath) {
            console.log('generatePlaceholderBanner called');
            console.log('Prompt:', prompt);
            console.log('Campaign name:', campaignName);
            console.log('Campaign path:', campaignPath);
            
            // For now, we'll use a placeholder service
            // In production, you'd integrate with a real AI image generation API
            
            // Simulate API call delay
            setTimeout(() => {
                console.log('Generating image URL...');
                // Use a placeholder image service that generates based on text
                const encodedPrompt = encodeURIComponent(prompt);
                const imageUrl = `https://source.unsplash.com/1600x900/?fantasy,landscape,${encodedPrompt}`;
                console.log('Generated image URL:', imageUrl);
                
                // Save banner data to database
                const bannerData = {
                    imageUrl: imageUrl,
                    campaignName: campaignName,
                    prompt: prompt,
                    generatedAt: Date.now()
                };
                console.log('Banner data to save:', bannerData);
                
                database.ref(`${campaignPath}/banner`).set(bannerData)
                    .then(() => {
                        console.log('Banner saved successfully');
                        renderCampaignBanner(imageUrl, campaignName);
                        resetBannerButtons();
                    })
                    .catch((error) => {
                        console.error('Error saving banner:', error);
                        alert('Error saving banner data');
                        resetBannerButtons();
                    });
            }, 2000); // Simulate 2-second generation time
        }

        function resetBannerButtons() {
            const generateBtn = document.getElementById('generateBannerBtn');
            const regenerateBtn = document.getElementById('regenerateBannerBtn');
            
            generateBtn.classList.remove('loading');
            generateBtn.textContent = '🎨 Generate Banner';
            regenerateBtn.classList.remove('loading');
            regenerateBtn.textContent = '🔄 Regenerate';
        }

        // Dice Roller Popup Functions
        let currentDiceType = 'd4';
        let currentQuantity = 1;
        let currentModifier = 0;
        let lastRollResult = '';
        let rollHistory = [];

        function toggleDiceRoller() {
            const popup = document.getElementById('diceRollerPopup');
            if (popup.style.display === 'block') {
                popup.style.display = 'none';
            } else {
                popup.style.display = 'block';
                updateDiceDisplayPopup();
            }
        }

        function updateDiceDisplayPopup() {
            const container = document.getElementById('diceContainerPopup');
            container.innerHTML = '';
            
            for (let i = 0; i < currentQuantity; i++) {
                const dice = document.createElement('div');
                dice.className = `dice-popup ${currentDiceType}`;
                dice.textContent = '?';
                dice.onclick = () => rollSingleDicePopup(dice);
                container.appendChild(dice);
            }
        }

        function rollSingleDicePopup(diceElement) {
            const result = rollDiceType(currentDiceType);
            diceElement.classList.add('rolling');
            diceElement.textContent = '?';
            
            setTimeout(() => {
                diceElement.classList.remove('rolling');
                diceElement.textContent = result;
                updateRollResultPopup(`${result} (1${currentDiceType})`);
                addToHistoryPopup([result], result, result);
            }, 800);
        }

        function rollDicePopup() {
            const diceElements = document.querySelectorAll('.dice-popup');
            const rollBtn = document.getElementById('rollDiceBtnPopup');
            
            rollBtn.disabled = true;
            rollBtn.textContent = '🎲 Rolling...';
            
            const results = [];
            let total = 0;
            
            // Roll each dice with animation
            diceElements.forEach((dice, index) => {
                setTimeout(() => {
                    const result = rollDiceType(currentDiceType);
                    results.push(result);
                    total += result;
                    
                    dice.classList.add('rolling');
                    dice.textContent = '?';
                    
                    setTimeout(() => {
                        dice.classList.remove('rolling');
                        dice.textContent = result;
                        
                        // Check if all dice have been rolled
                        if (results.length === currentQuantity) {
                            const finalTotal = total + currentModifier;
                            const modifierText = currentModifier !== 0 ? ` + ${currentModifier}` : '';
                            const resultsText = results.length > 1 ? `[${results.join(', ')}]` : results[0];
                            
                            updateRollResultPopup(`${finalTotal} (${currentQuantity}${currentDiceType}${modifierText} = ${resultsText}${modifierText})`);
                            addToHistoryPopup(results, total, finalTotal);
                            rollBtn.disabled = false;
                            rollBtn.textContent = '🎲 ROLL';
                        }
                    }, 800);
                }, index * 200); // Staggered rolls
            });
        }

        function rollDiceType(diceType) {
            const maxValue = parseInt(diceType.substring(1));
            return Math.floor(Math.random() * maxValue) + 1;
        }

        function updateRollResultPopup(result) {
            const resultElement = document.getElementById('rollResultPopup');
            resultElement.textContent = result;
            lastRollResult = result;
        }

        function addToHistoryPopup(results, subtotal, total) {
            const timestamp = new Date().toLocaleTimeString();
            const historyItem = {
                timestamp,
                diceType: currentDiceType,
                quantity: currentQuantity,
                modifier: currentModifier,
                results,
                subtotal,
                total
            };
            
            rollHistory.unshift(historyItem);
            if (rollHistory.length > 8) {
                rollHistory.pop(); // Keep only last 8 rolls for compact popup
            }
            
            updateHistoryDisplayPopup();
        }

        function updateHistoryDisplayPopup() {
            const historyList = document.getElementById('historyListPopup');
            historyList.innerHTML = '';
            
            rollHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item-popup';
                
                const modifierText = item.modifier !== 0 ? ` + ${item.modifier}` : '';
                const resultsText = item.results.length > 1 ? `[${item.results.join(', ')}]` : item.results[0];
                
                historyItem.innerHTML = `
                    <span class="roll-result">${item.total}</span> 
                    (${item.quantity}${item.diceType}${modifierText} = ${resultsText}${modifierText})
                    <br><small>${item.timestamp}</small>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        // Dice type selection for popup version
        document.addEventListener('DOMContentLoaded', function() {
            const diceTypeButtons = document.querySelectorAll('.dice-type-btn-popup');
            diceTypeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    diceTypeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDiceType = this.getAttribute('data-dice');
                    updateDiceDisplayPopup();
                });
            });
        });

        function changeQuantity(delta) {
            currentQuantity = Math.max(1, Math.min(10, currentQuantity + delta));
            document.getElementById('diceQuantityPopup').textContent = currentQuantity;
            updateDiceDisplayPopup();
        }

        function changeModifier(delta) {
            currentModifier = Math.max(-10, Math.min(10, currentModifier + delta));
            document.getElementById('diceModifierPopup').textContent = currentModifier;
        }



        // Keyboard shortcuts for popup version
        document.addEventListener('keydown', function(event) {
            const popup = document.getElementById('diceRollerPopup');
            
            if (popup.style.display === 'block') {
                if (event.key === 'Escape') {
                    toggleDiceRoller();
                } else if (event.key === 'Enter') {
                    const rollBtn = document.getElementById('rollDiceBtnPopup');
                    if (!rollBtn.disabled) {
                        rollDicePopup();
                    }
                }
            }
        });

        // Message Board Functions
        let messages = [];
        let currentMessageTab = 'all';

        function toggleMessageBoard() {
            const popup = document.getElementById('messageBoardPopup');
            if (popup.style.display === 'block') {
                popup.style.display = 'none';
            } else {
                popup.style.display = 'block';
                updateCharacterDropdown();
                loadMessages();
            }
        }

        function updateCharacterDropdown() {
            const select = document.getElementById('messageCharacterSelect');
            select.innerHTML = '<option value="">Select Character...</option>';
            
            characters.forEach(character => {
                const option = document.createElement('option');
                option.value = character.name;
                option.textContent = character.name;
                select.appendChild(option);
            });
        }

        function sendMessage() {
            const characterSelect = document.getElementById('messageCharacterSelect');
            const messageInput = document.getElementById('messageInput');
            const character = characterSelect.value;
            const content = messageInput.value.trim();
            
            if (!character) {
                alert('Please select a character first!');
                return;
            }
            
            if (!content) {
                alert('Please enter a message!');
                return;
            }
            
            const message = {
                id: Date.now(),
                character: character,
                content: content,
                timestamp: new Date().toLocaleTimeString(),
                type: 'ic' // Default to in-character
            };
            
            messages.push(message);
            saveMessages();
            displayMessages();
            messageInput.value = '';
            
            // Auto-scroll to bottom
            const messageList = document.getElementById('messageList');
            messageList.scrollTop = messageList.scrollHeight;
        }

        function loadMessages() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/messages`).once('value')
                .then((snapshot) => {
                    messages = snapshot.val() || [];
                    displayMessages();
                })
                .catch((error) => {
                    console.error('Error loading messages:', error);
                    messages = [];
                    displayMessages();
                });
        }

        function saveMessages() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/messages`).set(messages)
                .catch((error) => {
                    console.error('Error saving messages:', error);
                });
        }

        function displayMessages() {
            const messageList = document.getElementById('messageList');
            messageList.innerHTML = '';
            
            const filteredMessages = currentMessageTab === 'all' 
                ? messages 
                : messages.filter(msg => msg.type === currentMessageTab);
            
            filteredMessages.forEach(message => {
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                
                messageItem.innerHTML = `
                    <div class="message-header">
                        <span class="message-character">${message.character}</span>
                        <span class="message-time">${message.timestamp}</span>
                    </div>
                    <div class="message-content">${message.content}</div>
                `;
                
                messageList.appendChild(messageItem);
            });
            
            // Auto-scroll to bottom
            messageList.scrollTop = messageList.scrollHeight;
        }

        function switchMessageTab(tab) {
            currentMessageTab = tab;
            
            // Update active tab
            document.querySelectorAll('.message-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            displayMessages();
        }

        // Keyboard shortcuts for message board
        document.addEventListener('keydown', function(event) {
            const messageBoard = document.getElementById('messageBoardPopup');
            
            if (messageBoard.style.display === 'block') {
                if (event.key === 'Escape') {
                    toggleMessageBoard();
                } else if (event.key === 'Enter' && document.activeElement.id === 'messageInput') {
                    sendMessage();
                }
            }
        });

        // Setup real-time message listener
        function setupMessageListener() {
            const campaignPath = getCampaignPath();
            database.ref(`${campaignPath}/messages`).on('value', (snapshot) => {
                messages = snapshot.val() || [];
                if (document.getElementById('messageBoardPopup').style.display === 'block') {
                    displayMessages();
                }
            });
        }

        // Setup real-time listener
        function setupRealtimeListener() {
            const campaignPath = getCampaignPath();
            const charactersRef = database.ref(`${campaignPath}/characters`);
            
            console.log(`Setting up listener for guild: ${getGuildId()}, campaign: ${currentCampaignId} at path: ${campaignPath}/characters`);
            
            charactersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                console.log(`Data received for guild ${getGuildId()}, campaign ${currentCampaignId}:`, data);
                
                if (data) {
                    characters = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                } else {
                    characters = [];
                }
                
                renderCharacters();
                updateConnectionStatus();
            }, (error) => {
                console.error('Firebase data error:', error);
                updateConnectionStatus();
            });

            // Connection status
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                isConnected = snap.val();
                console.log('Firebase connection status:', isConnected);
                updateConnectionStatus();
            }, (error) => {
                console.error('Firebase connection error:', error);
                isConnected = false;
                updateConnectionStatus();
            });
        }

        // Update connection status
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (isConnected) {
                statusElement.textContent = '🟢 Connected';
                statusElement.className = 'connection-status';
            } else {
                statusElement.textContent = '🔴 Disconnected';
                statusElement.className = 'connection-status disconnected';
            }
        }

        // Track newly added characters for animation
        let newCharacterTimestamp = null;

        // Add a new character
        function addCharacter() {
            const campaignPath = getCampaignPath();
            const timestamp = Date.now();
            newCharacterTimestamp = timestamp;
            
            const newCharacter = {
                name: "New Character",
                class: "Fighter",
                level: 1,
                race: "Human",
                hp: 10,
                ac: 10,
                strength: 10,
                dexterity: 10,
                constitution: 10,
                intelligence: 10,
                wisdom: 10,
                charisma: 10,
                isDead: false,
                lastUpdated: timestamp
            };
            
            console.log(`Adding character to guild: ${getGuildId()}, campaign: ${currentCampaignId} at path: ${campaignPath}/characters`);
            
            // Add the character to Firebase
            database.ref(`${campaignPath}/characters`).push(newCharacter);
        }

        // Show delete confirmation dialog
        function removeCharacter(id) {
            const character = characters.find(char => char.id === id);
            const characterName = character ? character.name || 'Unnamed Character' : 'this character';
            
            showDeleteConfirmation(characterName, id);
        }

        // Show delete confirmation modal
        function showDeleteConfirmation(characterName, characterId) {
            const modal = document.getElementById('deleteConfirmationModal');
            const message = document.getElementById('deleteConfirmationMessage');
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const cancelBtn = document.getElementById('cancelDeleteBtn');
            
            message.textContent = `Are you sure you would like to delete ${characterName}?`;
            
            // Show modal
            modal.style.display = 'flex';
            
            // Set up button handlers
            confirmBtn.onclick = () => confirmDeleteCharacter(characterId);
            cancelBtn.onclick = hideDeleteConfirmation;
            
            // Close on background click
            modal.onclick = (e) => {
                if (e.target === modal) {
                    hideDeleteConfirmation();
                }
            };

            // Close on ESC key
            const handleKeyPress = (e) => {
                if (e.key === 'Escape') {
                    hideDeleteConfirmation();
                    document.removeEventListener('keydown', handleKeyPress);
                }
            };
            document.addEventListener('keydown', handleKeyPress);
        }

        // Hide delete confirmation modal
        function hideDeleteConfirmation() {
            const modal = document.getElementById('deleteConfirmationModal');
            modal.style.display = 'none';
        }

        // Actually delete the character after confirmation
        function confirmDeleteCharacter(id) {
            const campaignPath = getCampaignPath();
            console.log(`Removing character ${id} from guild: ${getGuildId()}, campaign: ${currentCampaignId}`);
            database.ref(`${campaignPath}/characters/${id}`).remove();
            hideDeleteConfirmation();
        }

        // Update a character field
        function updateCharacter(id, field, value) {
            const campaignPath = getCampaignPath();
            const updates = {};
            updates[`${campaignPath}/characters/${id}/${field}`] = value;
            updates[`${campaignPath}/characters/${id}/lastUpdated`] = Date.now();
            database.ref().update(updates);
            
            // Highlight stats if this was a stat update
            if (['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'].includes(field)) {
                setTimeout(() => highlightStats(id), 100);
            }
            
            // Update card texture if race was changed
            if (field === 'race') {
                setTimeout(() => updateCardTexture(id, value), 100);
            }
        }

        // Highlight highest and lowest stats
        function highlightStats(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;

            const card = document.querySelector(`[data-character-id="${characterId}"]`);
            if (!card) return;

            // Get all shield wrappers for this specific card
            const shieldWrappers = card.querySelectorAll('.stat-shield-wrapper');
            
            // Remove existing highlighting from shield wrappers
            shieldWrappers.forEach(wrapper => {
                wrapper.classList.remove('highest-stat', 'lowest-stat');
            });

            // Get stat values for this specific character only
            const stats = [
                { field: 'strength', value: character.strength || 0 },
                { field: 'dexterity', value: character.dexterity || 0 },
                { field: 'constitution', value: character.constitution || 0 },
                { field: 'intelligence', value: character.intelligence || 0 },
                { field: 'wisdom', value: character.wisdom || 0 },
                { field: 'charisma', value: character.charisma || 0 }
            ];

            // Find highest and lowest stats for this character only
            const maxStat = Math.max(...stats.map(s => s.value));
            const minStat = Math.min(...stats.map(s => s.value));

            // Apply highlighting only to this character's stats
            // Only highlight if there's actually a difference between stats
            if (maxStat !== minStat && maxStat > 0) {
                // Find and highlight the highest stat (only the first one if there are ties)
                const maxStats = stats.filter(stat => stat.value === maxStat);
                if (maxStats.length > 0) {
                    const inputs = card.querySelectorAll('.ability-input');
                    const input = Array.from(inputs).find(input => 
                        input.getAttribute('onchange') && 
                        input.getAttribute('onchange').includes(`'${maxStats[0].field}'`)
                    );
                    if (input) {
                        const wrapper = input.closest('.stat-shield-wrapper');
                        if (wrapper) wrapper.classList.add('highest-stat');
                    }
                }

                // Find and highlight the lowest stat (only the first one if there are ties)
                const minStats = stats.filter(stat => stat.value === minStat);
                if (minStats.length > 0) {
                    const inputs = card.querySelectorAll('.ability-input');
                    const input = Array.from(inputs).find(input => 
                        input.getAttribute('onchange') && 
                        input.getAttribute('onchange').includes(`'${minStats[0].field}'`)
                    );
                    if (input) {
                        const wrapper = input.closest('.stat-shield-wrapper');
                        if (wrapper) wrapper.classList.add('lowest-stat');
                    }
                }
            }
        }

        // Toggle death status
        function toggleDeath(characterId) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;
            
            const newDeathStatus = !character.isDead;
            updateCharacter(characterId, 'isDead', newDeathStatus);
        }

        // Toggle death save bubbles
        function toggleDeathSave(characterId, bubbleNumber) {
            const character = characters.find(c => c.id === characterId);
            if (!character) return;
            
            const currentSaves = character.deathSaves || 0;
            let newSaves;
            
            if (currentSaves >= bubbleNumber) {
                // If clicking on a filled bubble or higher, reduce to one less
                newSaves = bubbleNumber - 1;
            } else {
                // If clicking on an empty bubble, fill up to that bubble
                newSaves = bubbleNumber;
            }
            
            updateCharacter(characterId, 'deathSaves', newSaves);
        }

        // Helper function to get active tab class
        function getActiveTabClass(characterId, tabName) {
            const activeTab = activeTabs[characterId] || 'stats';
            return activeTab === tabName ? 'active' : '';
        }

        // Switch between tabs
        function switchTab(characterId, tabName) {
            // Store the active tab for this character
            activeTabs[characterId] = tabName;
            
            // Get the card element
            const card = document.querySelector(`[data-character-id="${characterId}"]`) || 
                        document.querySelector(`#stats-content-${characterId}`)?.closest('.character-card');
            
            if (!card) return;

            // Update tab buttons
            const tabButtons = card.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            // Update tab content
            const tabContents = card.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-content-${characterId}`) {
                    content.classList.add('active');
                }
            });
        }

        // Render all characters
        function renderCharacters() {
            const deck = document.getElementById('characterDeck');
            deck.innerHTML = '';
            
            characters.forEach((character, index) => {
                const card = createCharacterCard(character, index);
                deck.appendChild(card);
                
                // Highlight stats for this character
                setTimeout(() => highlightStats(character.id), 50);
            });
        }

        // Get texture class based on character race
        function getRaceTextureClass(race) {
            if (!race) return 'default';
            
            // Convert race name to lowercase and replace spaces/hyphens with hyphens
            const normalizedRace = race.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^a-z0-9-]/g, '');
            
            // Map of supported races to their texture classes
            const raceMap = {
                'human': 'human',
                'elf': 'elf', 
                'dwarf': 'dwarf',
                'halfling': 'halfling',
                'dragonborn': 'dragonborn',
                'tiefling': 'tiefling',
                'half-orc': 'half-orc',
                'gnome': 'gnome',
                'half-elf': 'half-elf',
                'aarakocra': 'aarakocra'
            };
            
            return raceMap[normalizedRace] || 'default';
        }

        // Update card texture based on race
        function updateCardTexture(characterId, race) {
            const card = document.querySelector(`[data-character-id="${characterId}"]`);
            if (!card) return;
            
            const textureElement = card.querySelector('.card-texture');
            if (!textureElement) return;
            
            // Remove all existing race classes from texture
            textureElement.className = 'card-texture';
            
            // Add new race class to texture
            textureElement.classList.add(getRaceTextureClass(race));
            
            // Remove all existing race classes from card
            card.classList.forEach(className => {
                if (className.startsWith('race-')) {
                    card.classList.remove(className);
                }
            });
            
            // Add new race class to card for header styling
            if (race) {
                const raceClass = 'race-' + getRaceTextureClass(race);
                card.classList.add(raceClass);
            }
        }

        // Create a character card element
        function createCharacterCard(character, index) {
            const card = document.createElement('div');
            card.className = 'character-card';
            if (character.isDead) {
                card.classList.add('dead');
            }
            
            // Add race class for styling
            if (character.race) {
                const raceClass = 'race-' + getRaceTextureClass(character.race);
                card.classList.add(raceClass);
            }
            
            // Add animation class for newly added characters
            // Check if this character was just added (within last 2 seconds)
            if (newCharacterTimestamp && character.lastUpdated === newCharacterTimestamp) {
                card.classList.add('new-card');
                console.log('Adding animation to new character:', character.name);
                // Clear the timestamp after applying animation
                setTimeout(() => {
                    newCharacterTimestamp = null;
                    card.classList.remove('new-card');
                }, 800); // Match animation duration
            }
            
            card.setAttribute('data-character-id', character.id);
            
            card.innerHTML = `
                <div class="card-texture ${getRaceTextureClass(character.race)}"></div>
                <div class="card-header">
                    <!-- Top Section: Name + HP/AC -->
                    <div class="header-top-section">
                        <input
                            type="text"
                            value="${character.name}"
                            onchange="updateCharacter('${character.id}', 'name', this.value)"
                            class="editable-field card-name"
                        >
                        <div class="header-stats">
                            <div class="header-stat">
                                <div class="hex-wrapper">
                                    <input
                                        type="number"
                                        value="${character.hp}"
                                        onchange="updateCharacter('${character.id}', 'hp', parseInt(this.value) || 0)"
                                        class="editable-field stat-input"
                        >
                    </div>
                            </div>
                            <div class="header-stat">
                                <div class="ac-inputs">
                                    <span class="heart-icon">❤️</span>
                                    <input
                                        type="number"
                                        value="${character.ac || 10}"
                                        onchange="updateCharacter('${character.id}', 'ac', parseInt(this.value) || 0)"
                                        class="editable-field ac-input"
                                    >
                                    <span class="ac-separator">/</span>
                                    <input
                                        type="number"
                                        value="${character.acMax || 10}"
                                        onchange="updateCharacter('${character.id}', 'acMax', parseInt(this.value) || 0)"
                                        class="editable-field ac-input"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Section: 6 Main Stats -->
                    <div class="header-bottom-section">
                        <div class="card-abilities">
                            <div class="ability-grid">
                                <div class="ability-item">
                                    <span class="ability-label">STR</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.strength}"
                                            onchange="updateCharacter('${character.id}', 'strength', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                                <div class="ability-item">
                                    <span class="ability-label">DEX</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.dexterity}"
                                            onchange="updateCharacter('${character.id}', 'dexterity', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                                <div class="ability-item">
                                    <span class="ability-label">CON</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.constitution}"
                                            onchange="updateCharacter('${character.id}', 'constitution', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                                <div class="ability-item">
                                    <span class="ability-label">INT</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.intelligence}"
                                            onchange="updateCharacter('${character.id}', 'intelligence', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                                <div class="ability-item">
                                    <span class="ability-label">WIS</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.wisdom}"
                                            onchange="updateCharacter('${character.id}', 'wisdom', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                                <div class="ability-item">
                                    <span class="ability-label">CHA</span>
                                    <div class="stat-shield-wrapper">
                                        <input
                                            type="number"
                                            value="${character.charisma}"
                                            onchange="updateCharacter('${character.id}', 'charisma', parseInt(this.value) || 0)"
                                            class="editable-field ability-input"
                                            min="1"
                                            max="20"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-tabs">
                            <button class="tab-btn ${getActiveTabClass(character.id, 'stats')}" onclick="switchTab('${character.id}', 'stats')" data-tab="stats">
                                Home
                            </button>
                            <button class="tab-btn ${getActiveTabClass(character.id, 'newstats')}" onclick="switchTab('${character.id}', 'newstats')" data-tab="newstats">
                                Stats
                            </button>
                            <button class="tab-btn ${getActiveTabClass(character.id, 'abilities')}" onclick="switchTab('${character.id}', 'abilities')" data-tab="abilities">
                                Skills
                            </button>
                            <button class="tab-btn ${getActiveTabClass(character.id, 'inventory')}" onclick="switchTab('${character.id}', 'inventory')" data-tab="inventory">
                                Bag
                            </button>
                            <button class="tab-btn ${getActiveTabClass(character.id, 'story')}" onclick="switchTab('${character.id}', 'story')" data-tab="story">
                                Story
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Stats Tab Content -->
                    <div class="tab-content ${getActiveTabClass(character.id, 'stats')}" id="stats-content-${character.id}">

                        <div class="character-image-section">
                            <div class="character-image-placeholder ${character.photo ? 'has-photo' : ''}" onclick="triggerPhotoUpload('${character.id}')">
                                <div class="image-placeholder-content">
                                    <span class="image-placeholder-text">Character Image</span>
                                    <span class="image-placeholder-subtext">Click to upload</span>
                                </div>
                                ${character.photo ? `<img src="${character.photo}" alt="Character" class="character-photo">` : ''}
                            </div>
                            <input type="file" id="photo-input-${character.id}" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event, '${character.id}')">
                        </div>

                        <div class="character-info-section">
                            <div class="info-row">
                                <div class="info-group-inline">
                                    <label class="info-label-inline">Class:</label>
                                    <input
                                        type="text"
                                        value="${character.class}"
                                        onchange="updateCharacter('${character.id}', 'class', this.value)"
                                        class="editable-field card-class-inline"
                                    >
                                </div>
                                <div class="info-group-inline">
                                    <label class="info-label-inline">Level:</label>
                                    <input
                                        type="number"
                                        value="${character.level}"
                                        onchange="updateCharacter('${character.id}', 'level', parseInt(this.value) || 1)"
                                        class="editable-field level-input-inline"
                                        min="1"
                                        max="20"
                                    >
                                </div>
                                <div class="info-group-inline">
                                    <label class="info-label-inline">Race:</label>
                                    <input
                                        type="text"
                                        value="${character.race}"
                                        onchange="updateCharacter('${character.id}', 'race', this.value)"
                                        class="editable-field race-input-inline"
                                    >
                                </div>
                            </div>
                        </div>

                        <div class="bio-section">
                            <div class="bio-item">
                                <textarea value="${character.bio || ''}" onchange="updateCharacter('${character.id}', 'bio', this.value)" class="editable-field bio-textarea" placeholder="Add a short bio of your character, what abilities they have and what they are after">${character.bio || ''}</textarea>
                            </div>
                        </div>

                        <div class="active-effects-section">
                            <div class="active-effects-item">
                                <label class="active-effects-label">Active Conditions:</label>
                                <textarea value="${character.activeEffects || ''}" onchange="updateCharacter('${character.id}', 'activeEffects', this.value)" class="editable-field active-effects-textarea" placeholder="Enter active effects, buffs, debuffs, conditions...">${character.activeEffects || ''}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Abilities Tab Content -->
                    <div class="tab-content ${getActiveTabClass(character.id, 'abilities')}" id="abilities-content-${character.id}">
                        <div class="abilities-section">
                            <div class="abilities-item">
                                <label class="abilities-label">Ability 1:</label>
                                <textarea value="${character.ability1 || ''}" onchange="updateCharacter('${character.id}', 'ability1', this.value)" class="editable-field abilities-textarea" placeholder="Enter ability description...">${character.ability1 || ''}</textarea>
                            </div>
                            <div class="abilities-item">
                                <label class="abilities-label">Ability 2:</label>
                                <textarea value="${character.ability2 || ''}" onchange="updateCharacter('${character.id}', 'ability2', this.value)" class="editable-field abilities-textarea" placeholder="Enter ability description...">${character.ability2 || ''}</textarea>
                            </div>
                            <div class="abilities-item">
                                <label class="abilities-label">Ability 3:</label>
                                <textarea value="${character.ability3 || ''}" onchange="updateCharacter('${character.id}', 'ability3', this.value)" class="editable-field abilities-textarea" placeholder="Enter ability description...">${character.ability3 || ''}</textarea>
                            </div>
                            <div class="abilities-item">
                                <label class="abilities-label">Ultimate Feature:</label>
                                <textarea value="${character.ultimate || ''}" onchange="updateCharacter('${character.id}', 'ultimate', this.value)" class="editable-field abilities-textarea" placeholder="Enter ultimate feature description...">${character.ultimate || ''}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Tab Content -->
                    <div class="tab-content ${getActiveTabClass(character.id, 'inventory')}" id="inventory-content-${character.id}">
                        <div class="inventory-section">
                            <div class="inventory-item">
                                <label class="inventory-label">Weapon:</label>
                                <input type="text" value="${character.weapon || ''}" onchange="updateCharacter('${character.id}', 'weapon', this.value)" class="editable-field inventory-input" placeholder="Enter weapon...">
                            </div>
                            <div class="inventory-item">
                                <label class="inventory-label">Armor:</label>
                                <input type="text" value="${character.armor || ''}" onchange="updateCharacter('${character.id}', 'armor', this.value)" class="editable-field inventory-input" placeholder="Enter armor...">
                            </div>
                            <div class="inventory-item">
                                <label class="inventory-label">Shield:</label>
                                <input type="text" value="${character.shield || ''}" onchange="updateCharacter('${character.id}', 'shield', this.value)" class="editable-field inventory-input" placeholder="Enter shield...">
                            </div>
                            <div class="inventory-item">
                                <label class="inventory-label">Items:</label>
                                <textarea value="${character.items || ''}" onchange="updateCharacter('${character.id}', 'items', this.value)" class="editable-field inventory-textarea" placeholder="Enter inventory items...">${character.items || ''}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Story Tab Content -->
                    <div class="tab-content ${getActiveTabClass(character.id, 'story')}" id="story-content-${character.id}">
                        <div class="story-section">
                            <div class="story-item">
                                <label class="story-label">Background:</label>
                                <textarea value="${character.background || ''}" onchange="updateCharacter('${character.id}', 'background', this.value)" class="editable-field story-textarea" placeholder="Enter character background...">${character.background || ''}</textarea>
                            </div>
                            <div class="story-item">
                                <label class="story-label">Personality:</label>
                                <textarea value="${character.personality || ''}" onchange="updateCharacter('${character.id}', 'personality', this.value)" class="editable-field story-textarea" placeholder="Enter personality traits...">${character.personality || ''}</textarea>
                            </div>
                            <div class="story-item">
                                <label class="story-label">Goals:</label>
                                <textarea value="${character.goals || ''}" onchange="updateCharacter('${character.id}', 'goals', this.value)" class="editable-field story-textarea" placeholder="Enter character goals...">${character.goals || ''}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- New Stats Tab Content -->
                    <div class="tab-content" id="newstats-content-${character.id}">
                        <!-- Content will be added here -->
                    </div>
                </div>
                
                <div class="card-footer">
                    <div class="footer-left">
                                            <button class="death-toggle-btn ${character.isDead ? '' : 'alive'}" onclick="toggleDeath('${character.id}')">
                        ${character.isDead ? '💀 Dead' : '⚡ Alive'}
                    </button>
                    </div>
                    <div class="footer-center">
                        <div class="death-saves">
                            <span class="death-saves-label">Death Saves</span>
                            <div class="death-saves-bubbles">
                                <div class="death-save-bubble ${(character.deathSaves || 0) >= 1 ? 'filled' : ''}" onclick="toggleDeathSave('${character.id}', 1)"></div>
                                <div class="death-save-bubble ${(character.deathSaves || 0) >= 2 ? 'filled' : ''}" onclick="toggleDeathSave('${character.id}', 2)"></div>
                                <div class="death-save-bubble ${(character.deathSaves || 0) >= 3 ? 'filled' : ''}" onclick="toggleDeathSave('${character.id}', 3)"></div>
                            </div>
                        </div>
                    </div>
                    <div class="footer-right">
                        <button class="remove-card-btn" onclick="removeCharacter('${character.id}')">
                            ✕
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Photo upload functions
        function triggerPhotoUpload(characterId) {
            const fileInput = document.getElementById(`photo-input-${characterId}`);
            fileInput.click();
        }

        function handlePhotoUpload(event, characterId) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (limit to 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Photo size must be less than 5MB');
                return;
            }

            // Check file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                
                // Update character with photo data
                updateCharacter(characterId, 'photo', base64Image);
                
                // Update the UI immediately
                updatePhotoDisplay(characterId, base64Image);
            };
            reader.readAsDataURL(file);
        }

        function updatePhotoDisplay(characterId, photoData) {
            const placeholder = document.querySelector(`[data-character-id="${characterId}"] .character-image-placeholder`);
            if (!placeholder) return;

            // Remove existing photo
            const existingPhoto = placeholder.querySelector('.character-photo');
            if (existingPhoto) {
                existingPhoto.remove();
            }

            if (photoData) {
                // Add has-photo class
                placeholder.classList.add('has-photo');
                
                // Create and add new photo
                const img = document.createElement('img');
                img.src = photoData;
                img.alt = 'Character';
                img.className = 'character-photo';
                placeholder.appendChild(img);
            } else {
                // Remove has-photo class
                placeholder.classList.remove('has-photo');
            }
        }
    </script>
            <footer class="basic-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <button class="dice-roller-btn" onclick="toggleDiceRoller()">
                        🎲 Roll Dice
                    </button>
                </div>
                <div class="footer-middle">
                    <div class="music-player">
                        <audio controls class="runescape-audio">
                            <source src="music/background-music.mp3" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                </div>
                <div class="footer-right">
                    <button class="message-board-btn" onclick="toggleMessageBoard()">
                        💬 Message Board
                    </button>
                </div>
            </div>
        </footer>

    <!-- Small Dice Roller Popup -->
    <div class="dice-roller-popup" id="diceRollerPopup">
        <div class="dice-roller-popup-content">
            <div class="dice-roller-popup-header">
                <h3>🎲 Dice Roller</h3>
                <button class="close-dice-popup-btn" onclick="toggleDiceRoller()">✕</button>
            </div>
            
            <div class="dice-roller-popup-body">
                <div class="dice-selection-popup">
                    <div class="dice-type-selector-popup">
                        <button class="dice-type-btn-popup active" data-dice="d4">d4</button>
                        <button class="dice-type-btn-popup" data-dice="d6">d6</button>
                        <button class="dice-type-btn-popup" data-dice="d8">d8</button>
                        <button class="dice-type-btn-popup" data-dice="d10">d10</button>
                        <button class="dice-type-btn-popup" data-dice="d12">d12</button>
                        <button class="dice-type-btn-popup" data-dice="d20">d20</button>
                        <button class="dice-type-btn-popup" data-dice="d100">d100</button>
                    </div>
                    
                    <div class="dice-controls-popup">
                        <div class="control-group">
                            <label>Qty:</label>
                            <div class="quantity-controls-popup">
                                <button class="control-btn-popup" onclick="changeQuantity(-1)">-</button>
                                <span id="diceQuantityPopup">1</span>
                                <button class="control-btn-popup" onclick="changeQuantity(1)">+</button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label>Mod:</label>
                            <div class="modifier-controls-popup">
                                <button class="control-btn-popup" onclick="changeModifier(-1)">-</button>
                                <span id="diceModifierPopup">0</span>
                                <button class="control-btn-popup" onclick="changeModifier(1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dice-tray-popup" id="diceTrayPopup">
                    <div class="dice-container-popup" id="diceContainerPopup">
                        <!-- Dice will be added here -->
                    </div>
                    <button class="roll-dice-btn-popup" onclick="rollDicePopup()" id="rollDiceBtnPopup">
                        🎲 ROLL
                    </button>
                </div>
                
                <div class="roll-result-popup" id="rollResultPopup">
                    <!-- Latest roll result will be shown here -->
                </div>
                
                <div class="roll-history-popup" id="rollHistoryPopup">
                    <h4>Roll History</h4>
                    <div class="history-list-popup" id="historyListPopup">
                        <!-- Roll history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Board Popup -->
    <div class="message-board-popup" id="messageBoardPopup">
        <div class="message-board-popup-content">
            <div class="message-board-popup-header">
                <h3>💬 Message Board</h3>
                <button class="close-message-board-btn" onclick="toggleMessageBoard()">✕</button>
            </div>
            
            <div class="message-board-popup-body">
                <div class="message-input-section">
                    <div class="character-selector">
                        <label>Character:</label>
                        <select id="messageCharacterSelect" class="character-select">
                            <option value="">Select Character...</option>
                        </select>
                    </div>
                    <div class="message-input-container">
                        <input type="text" id="messageInput" class="message-input" placeholder="Type your message..." maxlength="200">
                        <button class="send-message-btn" onclick="sendMessage()" id="sendMessageBtn">
                            Send
                        </button>
                    </div>
                </div>
                
                <div class="message-display" id="messageDisplay">
                    <div class="message-list" id="messageList">
                        <!-- Messages will be displayed here -->
                    </div>
                </div>
                
                <div class="message-tabs">
                    <button class="message-tab active" data-tab="all" onclick="switchMessageTab('all')">All</button>
                    <button class="message-tab" data-tab="ooc" onclick="switchMessageTab('ooc')">OOC</button>
                    <button class="message-tab" data-tab="ic" onclick="switchMessageTab('ic')">IC</button>
                    <button class="message-tab" data-tab="dm" onclick="switchMessageTab('dm')">DM</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-confirmation-modal" id="deleteConfirmationModal">
        <div class="delete-confirmation-content">
            <div class="delete-confirmation-title">Delete Character</div>
            <div class="delete-confirmation-message" id="deleteConfirmationMessage">
                Are you sure you would like to delete this character?
            </div>
            <div class="delete-confirmation-buttons">
                <button class="delete-confirm-btn" id="confirmDeleteBtn">Delete</button>
                <button class="delete-cancel-btn" id="cancelDeleteBtn">Nevermind</button>
            </div>
        </div>
    </div>

</body>
</html> 